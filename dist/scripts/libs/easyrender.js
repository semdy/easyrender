var EC={version:"1.0.7"};!function(t){"use strict";var e=Array.prototype.slice,i=Object.prototype.toString,o=Object.prototype.hasOwnProperty,n=Array.prototype,s=Function.prototype;!!Date.now||(Date.now=function(){return+new Date}),!!s.bind||(s.bind=function(){var t=this,e=[].shift.call(arguments),i=[].slice.call(arguments);return function(){return t.apply(e,[].concat.call(i,[].slice.call(arguments)))}}),!!n.find||(n.find=function(t){for(var e=0,i=this.length;e<i;e++)if(t&&t(this[e],e,this)===!0)return this[e]}),!!Array.isArray||(Array.isArray=function(t){return"[object Array]"===i.call(t)}),n.contains=n.includes||function(t){return this.indexOf(t)>-1};var r=function(){function t(){}return function(e){if(null!==e&&"object"!=typeof e&&"function"!=typeof e)throw TypeError("Argument must be an object, or null");t.prototype=e;var i=new t;if(t.prototype=null,arguments.length>1){var n=Object(arguments[1]);for(var s in n)o.call(n,s)&&(i[s]=n[s])}return i}}(),a="ontouchstart"in document,h=navigator.userAgent,c=window.navigator.msPointerEnabled,l=c&&/IEMobile/i.test(h);a=a||l||!1;var u=l?{START:"MSPointerDown",MOVE:"MSPointerMove",END:"MSPointerCancel"}:{START:a?"touchstart":"mousedown",MOVE:a?"touchmove":"mousemove",END:a?"touchend":"mouseup"};u.RESIZE="onorientationchange"in window?"orientationchange":"resize";var p=function(){return Object.assign||function(t){for(var i,o,n=e.call(arguments,1),s=0;s<n.length;s++)for(o in i=n[s])i.hasOwnProperty(o)&&(t[o]=i[o]);return t}}();t.provide=function(e){if("object"==typeof e)return p(t,e),t},t.provide({isDefined:function(t){return"undefined"!=typeof t},isNumber:function(t){return"number"==typeof t},isString:function(t){return"string"==typeof t},isFunction:function(t){return"function"==typeof t},isObject:function(t){return"object"==typeof t},isArray:Array.isArray,camelize:function(t){return t.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()})},lowercase:function(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})},getStyle:function(e,i){return window.getComputedStyle(e,null)[t.camelize(i)]}});var d=function(t,e){var i,n=this;return i=t&&o.call(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},p(i,n,e),i.prototype=r(n.prototype,t),i.prototype.constructor=i,i.superclass=n.prototype,i};t.provide({extend:p,classExtend:d,ua:h,isTouch:a,noop:function(){},EVENTS:u})}(EC);var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(t){return clearTimeout(t)};!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define,1){var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}else define(t)}(function(){return function t(e,i,o){function n(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){var i=e[r][1][t];return n(i?i:t)},c,c.exports,t,e,i,o)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}({1:[function(t,e,i){function o(){}var n=t("./Scalar");e.exports=o,o.lineInt=function(t,e,i){i=i||0;var o,s,r,a,h,c,l,u=[0,0];return o=t[1][1]-t[0][1],s=t[0][0]-t[1][0],r=o*t[0][0]+s*t[0][1],a=e[1][1]-e[0][1],h=e[0][0]-e[1][0],c=a*e[0][0]+h*e[0][1],l=o*h-a*s,n.eq(l,0,i)||(u[0]=(h*r-s*c)/l,u[1]=(o*c-a*r)/l),u},o.segmentsIntersect=function(t,e,i,o){var n=e[0]-t[0],s=e[1]-t[1],r=o[0]-i[0],a=o[1]-i[1];if(r*s-a*n==0)return!1;var h=(n*(i[1]-t[1])+s*(t[0]-i[0]))/(r*s-a*n),c=(r*(t[1]-i[1])+a*(i[0]-t[0]))/(a*n-r*s);return h>=0&&h<=1&&c>=0&&c<=1}},{"./Scalar":4}],2:[function(t,e,i){function o(){}e.exports=o,o.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},o.left=function(t,e,i){return o.area(t,e,i)>0},o.leftOn=function(t,e,i){return o.area(t,e,i)>=0},o.right=function(t,e,i){return o.area(t,e,i)<0},o.rightOn=function(t,e,i){return o.area(t,e,i)<=0};var n=[],s=[];o.collinear=function(t,e,i,r){if(r){var a=n,h=s;a[0]=e[0]-t[0],a[1]=e[1]-t[1],h[0]=i[0]-e[0],h[1]=i[1]-e[1];var c=a[0]*h[0]+a[1]*h[1],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=Math.sqrt(h[0]*h[0]+h[1]*h[1]),p=Math.acos(c/(l*u));return p<r}return 0==o.area(t,e,i)},o.sqdist=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}},{}],3:[function(t,e,i){function o(){this.vertices=[]}function n(t,e,i,o,n){n=n||0;var s=e[1]-t[1],r=t[0]-e[0],h=s*t[0]+r*t[1],c=o[1]-i[1],l=i[0]-o[0],u=c*i[0]+l*i[1],p=s*l-c*r;return a.eq(p,0,n)?[0,0]:[(l*h-r*u)/p,(s*u-c*h)/p]}var s=t("./Line"),r=t("./Point"),a=t("./Scalar");e.exports=o,o.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(t,e,i){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var o=e;o<i;o++)this.vertices.push(t.vertices[o])},o.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);r.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},o.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},o.prototype.isReflex=function(t){return r.right(this.at(t-1),this.at(t),this.at(t+1))};var h=[],c=[];o.prototype.canSee=function(t,e){var i,o,n=h,a=c;if(r.leftOn(this.at(t+1),this.at(t),this.at(e))&&r.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=r.sqdist(this.at(t),this.at(e));for(var l=0;l!==this.vertices.length;++l)if((l+1)%this.vertices.length!==t&&l!==t&&r.leftOn(this.at(t),this.at(e),this.at(l+1))&&r.rightOn(this.at(t),this.at(e),this.at(l))&&(n[0]=this.at(t),n[1]=this.at(e),a[0]=this.at(l),a[1]=this.at(l+1),i=s.lineInt(n,a),r.sqdist(this.at(t),i)<o))return!1;return!0},o.prototype.copy=function(t,e,i){var n=i||new o;if(n.clear(),t<e)for(var s=t;s<=e;s++)n.vertices.push(this.vertices[s]);else{for(var s=0;s<=e;s++)n.vertices.push(this.vertices[s]);for(var s=t;s<this.vertices.length;s++)n.vertices.push(this.vertices[s])}return n},o.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new o,s=Number.MAX_VALUE,r=0;r<this.vertices.length;++r)if(this.isReflex(r))for(var a=0;a<this.vertices.length;++a)if(this.canSee(r,a)){e=this.copy(r,a,n).getCutEdges(),i=this.copy(a,r,n).getCutEdges();for(var h=0;h<i.length;h++)e.push(i[h]);e.length<s&&(t=e,s=e.length,t.push([this.at(r),this.at(a)]))}return t},o.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},o.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var o=t[i],n=0;n<e.length;n++){var s=e[n],r=s.slice(o);if(r){e.splice(n,1),e.push(r[0],r[1]);break}}return e}var o=t,i=this.vertices.indexOf(o[0]),n=this.vertices.indexOf(o[1]);return i!=-1&&n!=-1&&[this.copy(i,n),this.copy(n,i)]},o.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(s.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(var e=1;e<t.length-2;e++)if(s.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},o.prototype.quickDecomp=function(t,e,i,s,a,h){a=a||100,h=h||0,s=s||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var c=[0,0],l=[0,0],u=[0,0],p=0,d=0,f=0,v=0,m=0,y=0,g=0,b=new o,A=new o,w=this,E=this.vertices;if(E.length<3)return t;if(h++,h>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var x=0;x<this.vertices.length;++x)if(w.isReflex(x)){e.push(w.vertices[x]),p=d=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S)r.left(w.at(x-1),w.at(x),w.at(S))&&r.rightOn(w.at(x-1),w.at(x),w.at(S-1))&&(u=n(w.at(x-1),w.at(x),w.at(S),w.at(S-1)),r.right(w.at(x+1),w.at(x),u)&&(f=r.sqdist(w.vertices[x],u),f<d&&(d=f,l=u,y=S))),r.left(w.at(x+1),w.at(x),w.at(S+1))&&r.rightOn(w.at(x+1),w.at(x),w.at(S))&&(u=n(w.at(x+1),w.at(x),w.at(S),w.at(S+1)),r.left(w.at(x-1),w.at(x),u)&&(f=r.sqdist(w.vertices[x],u),f<p&&(p=f,c=u,m=S)));if(y==(m+1)%this.vertices.length)u[0]=(l[0]+c[0])/2,u[1]=(l[1]+c[1])/2,i.push(u),x<m?(b.append(w,x,m+1),b.vertices.push(u),A.vertices.push(u),0!=y&&A.append(w,y,w.vertices.length),A.append(w,0,x+1)):(0!=x&&b.append(w,x,w.vertices.length),b.append(w,0,m+1),b.vertices.push(u),A.vertices.push(u),A.append(w,y,x+1));else{if(y>m&&(m+=this.vertices.length),v=Number.MAX_VALUE,m<y)return t;for(var S=y;S<=m;++S)r.leftOn(w.at(x-1),w.at(x),w.at(S))&&r.rightOn(w.at(x+1),w.at(x),w.at(S))&&(f=r.sqdist(w.at(x),w.at(S)),f<v&&(v=f,g=S%this.vertices.length));x<g?(b.append(w,x,g+1),0!=g&&A.append(w,g,E.length),A.append(w,0,x+1)):(0!=x&&b.append(w,x,E.length),b.append(w,0,g+1),A.append(w,g,x+1))}return b.vertices.length<A.vertices.length?(b.quickDecomp(t,e,i,s,a,h),A.quickDecomp(t,e,i,s,a,h)):(A.quickDecomp(t,e,i,s,a,h),b.quickDecomp(t,e,i,s,a,h)),t}return t.push(this),t},o.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)r.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function o(){}e.exports=o,o.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(t,e,i){function o(t){this.lowerBound=n.create(),t&&t.lowerBound&&n.copy(this.lowerBound,t.lowerBound),this.upperBound=n.create(),t&&t.upperBound&&n.copy(this.upperBound,t.upperBound)}var n=t("../math/vec2");t("../utils/Utils");e.exports=o;var s=n.create();o.prototype.setFromPoints=function(t,e,i,o){var r=this.lowerBound,a=this.upperBound;"number"!=typeof i&&(i=0),0!==i?n.rotate(r,t[0],i):n.copy(r,t[0]),n.copy(a,r);for(var h=Math.cos(i),c=Math.sin(i),l=1;l<t.length;l++){var u=t[l];if(0!==i){var p=u[0],d=u[1];s[0]=h*p-c*d,s[1]=c*p+h*d,u=s}for(var f=0;f<2;f++)u[f]>a[f]&&(a[f]=u[f]),u[f]<r[f]&&(r[f]=u[f])}e&&(n.add(this.lowerBound,this.lowerBound,e),n.add(this.upperBound,this.upperBound,e)),o&&(this.lowerBound[0]-=o,this.lowerBound[1]-=o,this.upperBound[0]+=o,this.upperBound[1]+=o)},o.prototype.copy=function(t){n.copy(this.lowerBound,t.lowerBound),n.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var o=t.upperBound[e];this.upperBound[e]<o&&(this.upperBound[e]=o)}},o.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,o=t.lowerBound,n=t.upperBound;return(o[0]<=i[0]&&i[0]<=n[0]||e[0]<=n[0]&&n[0]<=i[0])&&(o[1]<=i[1]&&i[1]<=n[1]||e[1]<=n[1]&&n[1]<=i[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],o=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,s=(this.lowerBound[1]-t.from[1])*i,r=(this.upperBound[1]-t.from[1])*i,a=Math.max(Math.max(Math.min(o,n),Math.min(s,r))),h=Math.min(Math.min(Math.max(o,n),Math.max(s,r)));return h<0?-1:a>h?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var n=t("../math/vec2"),s=t("../objects/Body");e.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(t){};var r=n.create();o.boundingRadiusCheck=function(t,e){n.sub(r,t.position,e.position);var i=n.squaredLength(r),o=t.boundingRadius+e.boundingRadius;return i<=o*o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var i=s.KINEMATIC,o=s.STATIC;return(t.type!==o||e.type!==o)&&(!(t.type===i&&e.type===o||t.type===o&&e.type===i)&&((t.type!==i||e.type!==i)&&((t.sleepState!==s.SLEEPING||e.sleepState!==s.SLEEPING)&&!(t.sleepState===s.SLEEPING&&e.type===o||e.sleepState===s.SLEEPING&&t.type===o))))},o.NAIVE=1,o.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function o(){n.call(this,n.NAIVE)}var n=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var o=0,s=e.length;o!==s;o++)for(var r=e[o],a=0;a<o;a++){var h=e[a];n.canCollide(r,h)&&this.boundingVolumeCheck(r,h)&&i.push(r,h)}return i},o.prototype.aabbQuery=function(t,e,i){i=i||[];for(var o=t.bodies,n=0;n<o.length;n++){var s=o[n];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new l({size:32}),this.frictionEquationPool=new u({size:64}),this.restitution=0,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.frictionStiffness=d.DEFAULT_STIFFNESS,this.frictionRelaxation=d.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new p,this.contactSkinSize=.01}function n(t,e){r.set(t.vertices[0],.5*-e.length,-e.radius),r.set(t.vertices[1],.5*e.length,-e.radius),r.set(t.vertices[2],.5*e.length,e.radius),r.set(t.vertices[3],.5*-e.length,e.radius)}function s(t,e,i,o){for(var n=X,s=Y,c=W,l=H,u=t,p=e.vertices,d=null,f=0;f!==p.length+1;f++){var v=p[f%p.length],m=p[(f+1)%p.length];r.rotate(n,v,o),r.rotate(s,m,o),h(n,n,i),h(s,s,i),a(c,n,u),a(l,s,u);var y=r.crossLength(c,l);if(null===d&&(d=y),y*d<=0)return!1;d=y}return!0}var r=t("../math/vec2"),a=r.sub,h=r.add,c=r.dot,l=(t("../utils/Utils"),t("../utils/ContactEquationPool")),u=t("../utils/FrictionEquationPool"),p=t("../utils/TupleDictionary"),d=t("../equations/Equation"),f=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),v=t("../shapes/Convex"),m=t("../shapes/Shape"),y=(t("../objects/Body"),t("../shapes/Box"));e.exports=o;var g=r.fromValues(0,1),b=r.fromValues(0,0),A=r.fromValues(0,0),w=r.fromValues(0,0),E=r.fromValues(0,0),x=r.fromValues(0,0),S=r.fromValues(0,0),B=r.fromValues(0,0),C=r.fromValues(0,0),P=r.fromValues(0,0),q=r.fromValues(0,0),F=r.fromValues(0,0),T=r.fromValues(0,0),L=r.fromValues(0,0),M=r.fromValues(0,0),_=r.fromValues(0,0),R=r.fromValues(0,0),I=r.fromValues(0,0),O=r.fromValues(0,0),k=[],V=r.create(),N=r.create();o.prototype.bodiesOverlap=function(t,e){for(var i=V,o=N,n=0,s=t.shapes.length;n!==s;n++){var r=t.shapes[n];t.toWorldFrame(i,r.position);for(var a=0,h=e.shapes.length;a!==h;a++){var c=e.shapes[a];if(e.toWorldFrame(o,c.position),this[r.type|c.type](t,r,i,r.angle+t.angle,e,c,o,c.angle+e.angle,!0))return!0}}return!1},o.prototype.collidedLastStep=function(t,e){var i=0|t.id,o=0|e.id;return!!this.collidingBodiesLastStep.get(i,o)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],o=i.bodyA.id,n=i.bodyB.id;this.collidingBodiesLastStep.set(o,n,!0)}for(var s=this.contactEquations,r=this.frictionEquations,a=0;a<s.length;a++)this.contactEquationPool.release(s[a]);for(var a=0;a<r.length;a++)this.frictionEquationPool.release(r[a]);this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(t,e,i,o){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},o.prototype.createFrictionEquation=function(t,e,i,o){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},o.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return r.copy(e.contactPointA,t.contactPointA),r.copy(e.contactPointB,t.contactPointB),r.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},o.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),o=e.bodyA;e.bodyB;r.set(i.contactPointA,0,0),r.set(i.contactPointB,0,0),r.set(i.t,0,0);for(var n=0;n!==t;n++)e=this.contactEquations[this.contactEquations.length-1-n],e.bodyA===o?(r.add(i.t,i.t,e.normalA),r.add(i.contactPointA,i.contactPointA,e.contactPointA),r.add(i.contactPointB,i.contactPointB,e.contactPointB)):(r.sub(i.t,i.t,e.normalA),r.add(i.contactPointA,i.contactPointA,e.contactPointB),r.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var s=1/t;return r.scale(i.contactPointA,i.contactPointA,s),r.scale(i.contactPointB,i.contactPointB,s),r.normalize(i.t,i.t),r.rotate90cw(i.t,i.t),i},o.prototype[m.LINE|m.CONVEX]=o.prototype.convexLine=function(t,e,i,o,n,s,r,a,h){return!h&&0},o.prototype[m.LINE|m.BOX]=o.prototype.lineBox=function(t,e,i,o,n,s,r,a,h){return!h&&0};var G=new y({width:1,height:1}),D=r.create();o.prototype[m.CAPSULE|m.CONVEX]=o.prototype[m.CAPSULE|m.BOX]=o.prototype.convexCapsule=function(t,e,i,o,s,a,h,c,l){var u=D;r.set(u,a.length/2,0),r.rotate(u,u,c),r.add(u,u,h);var p=this.circleConvex(s,a,u,c,t,e,i,o,l,a.radius);r.set(u,-a.length/2,0),r.rotate(u,u,c),r.add(u,u,h);var d=this.circleConvex(s,a,u,c,t,e,i,o,l,a.radius);if(l&&(p||d))return!0;var f=G;n(f,a);var v=this.convexConvex(t,e,i,o,s,f,h,c,l);return v+p+d},o.prototype[m.CAPSULE|m.LINE]=o.prototype.lineCapsule=function(t,e,i,o,n,s,r,a,h){return!h&&0};var U=r.create(),j=r.create(),z=new y({width:1,height:1});o.prototype[m.CAPSULE|m.CAPSULE]=o.prototype.capsuleCapsule=function(t,e,i,o,s,a,h,c,l){for(var u,p=U,d=j,f=0,v=0;v<2;v++){r.set(p,(0===v?-1:1)*e.length/2,0),r.rotate(p,p,o),r.add(p,p,i);for(var m=0;m<2;m++){r.set(d,(0===m?-1:1)*a.length/2,0),r.rotate(d,d,c),r.add(d,d,h),this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var y=this.circleCircle(t,e,p,o,s,a,d,c,l,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=u),l&&y)return!0;f+=y}}this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var g=z;n(g,e);var b=this.convexCapsule(t,g,i,o,s,a,h,c,l);if(this.enableFrictionReduction&&(this.enableFriction=u),l&&b)return!0;if(f+=b,this.enableFrictionReduction){var u=this.enableFriction;this.enableFriction=!1}n(g,a);var A=this.convexCapsule(s,g,h,c,t,e,i,o,l);return this.enableFrictionReduction&&(this.enableFriction=u),!(!l||!A)||(f+=A,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},o.prototype[m.LINE|m.LINE]=o.prototype.lineLine=function(t,e,i,o,n,s,r,a,h){return!h&&0},o.prototype[m.PLANE|m.LINE]=o.prototype.planeLine=function(t,e,i,o,n,s,l,u,p){var d=b,f=A,v=w,m=E,y=x,q=S,F=B,T=C,L=P,M=k,_=0;r.set(d,-s.length/2,0),r.set(f,s.length/2,0),r.rotate(v,d,u),r.rotate(m,f,u),h(v,v,l),h(m,m,l),r.copy(d,v),r.copy(f,m),a(y,f,d),r.normalize(q,y),r.rotate90cw(L,q),r.rotate(T,g,o),M[0]=d,M[1]=f;for(var R=0;R<M.length;R++){var I=M[R];a(F,I,i);var O=c(F,T);if(O<0){if(p)return!0;var V=this.createContactEquation(t,n,e,s);_++,r.copy(V.normalA,T),r.normalize(V.normalA,V.normalA),r.scale(F,T,O),a(V.contactPointA,I,F),a(V.contactPointA,V.contactPointA,t.position),a(V.contactPointB,I,l),h(V.contactPointB,V.contactPointB,l),a(V.contactPointB,V.contactPointB,n.position),this.contactEquations.push(V),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(V))}}return!p&&(this.enableFrictionReduction||_&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(_)),_)},o.prototype[m.PARTICLE|m.CAPSULE]=o.prototype.particleCapsule=function(t,e,i,o,n,s,r,a,h){return this.circleLine(t,e,i,o,n,s,r,a,h,s.radius,0)},o.prototype[m.CIRCLE|m.LINE]=o.prototype.circleLine=function(t,e,i,o,n,s,l,u,p,d,f){var d=d||0,f="undefined"!=typeof f?f:e.radius,v=b,m=A,y=w,g=E,_=x,R=S,I=B,O=C,V=P,N=q,G=F,D=T,U=L,j=M,z=k;r.set(O,-s.length/2,0),r.set(V,s.length/2,0),r.rotate(N,O,u),r.rotate(G,V,u),h(N,N,l),h(G,G,l),r.copy(O,N),r.copy(V,G),a(R,V,O),r.normalize(I,R),r.rotate90cw(_,I),a(D,i,O);var X=c(D,_);a(g,O,l),a(U,i,l);var Y=f+d;if(Math.abs(X)<Y){r.scale(v,_,X),a(y,i,v),r.scale(m,_,c(_,U)),r.normalize(m,m),r.scale(m,m,d),h(y,y,m);var W=c(I,y),H=c(I,O),$=c(I,V);if(W>H&&W<$){if(p)return!0;var K=this.createContactEquation(t,n,e,s);return r.scale(K.normalA,v,-1),r.normalize(K.normalA,K.normalA),r.scale(K.contactPointA,K.normalA,f),h(K.contactPointA,K.contactPointA,i),a(K.contactPointA,K.contactPointA,t.position),a(K.contactPointB,y,l),h(K.contactPointB,K.contactPointB,l),a(K.contactPointB,K.contactPointB,n.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}}z[0]=O,z[1]=V;for(var Z=0;Z<z.length;Z++){var J=z[Z];if(a(D,J,i),r.squaredLength(D)<Math.pow(Y,2)){if(p)return!0;var K=this.createContactEquation(t,n,e,s);return r.copy(K.normalA,D),r.normalize(K.normalA,K.normalA),r.scale(K.contactPointA,K.normalA,f),h(K.contactPointA,K.contactPointA,i),a(K.contactPointA,K.contactPointA,t.position),a(K.contactPointB,J,l),r.scale(j,K.normalA,-d),h(K.contactPointB,K.contactPointB,j),h(K.contactPointB,K.contactPointB,l),a(K.contactPointB,K.contactPointB,n.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1}}return 0},o.prototype[m.CIRCLE|m.CAPSULE]=o.prototype.circleCapsule=function(t,e,i,o,n,s,r,a,h){return this.circleLine(t,e,i,o,n,s,r,a,h,s.radius)},o.prototype[m.CIRCLE|m.CONVEX]=o.prototype[m.CIRCLE|m.BOX]=o.prototype.circleConvex=function(t,e,i,o,n,c,l,u,p,d){for(var d="number"==typeof d?d:e.radius,f=b,v=A,m=w,y=E,g=x,S=q,B=F,C=L,P=M,T=_,I=R,O=!1,k=Number.MAX_VALUE,V=c.vertices,N=0;N!==V.length+1;N++){var G=V[N%V.length],D=V[(N+1)%V.length];if(r.rotate(f,G,u),r.rotate(v,D,u),h(f,f,l),h(v,v,l),a(m,v,f),r.normalize(y,m),r.rotate90cw(g,y),r.scale(P,g,-e.radius),h(P,P,i),s(P,c,l,u)){r.sub(T,f,P);var U=Math.abs(r.dot(T,g));U<k&&(r.copy(I,P),k=U,r.scale(C,g,U),r.add(C,C,P),O=!0)}}if(O){if(p)return!0;var j=this.createContactEquation(t,n,e,c);return r.sub(j.normalA,I,i),r.normalize(j.normalA,j.normalA),r.scale(j.contactPointA,j.normalA,d),h(j.contactPointA,j.contactPointA,i),a(j.contactPointA,j.contactPointA,t.position),a(j.contactPointB,C,l),h(j.contactPointB,j.contactPointB,l),a(j.contactPointB,j.contactPointB,n.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}if(d>0)for(var N=0;N<V.length;N++){var z=V[N];if(r.rotate(B,z,u),h(B,B,l),a(S,B,i),r.squaredLength(S)<Math.pow(d,2)){if(p)return!0;var j=this.createContactEquation(t,n,e,c);return r.copy(j.normalA,S),r.normalize(j.normalA,j.normalA),r.scale(j.contactPointA,j.normalA,d),h(j.contactPointA,j.contactPointA,i),a(j.contactPointA,j.contactPointA,t.position),a(j.contactPointB,B,l),h(j.contactPointB,j.contactPointB,l),a(j.contactPointB,j.contactPointB,n.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}}return 0};var X=r.create(),Y=r.create(),W=r.create(),H=r.create();o.prototype[m.PARTICLE|m.CONVEX]=o.prototype[m.PARTICLE|m.BOX]=o.prototype.particleConvex=function(t,e,i,o,n,l,u,p,d){var f=b,v=A,m=w,y=E,g=x,C=S,P=B,F=q,T=L,M=I,_=O,R=Number.MAX_VALUE,k=!1,V=l.vertices;if(!s(i,l,u,p))return 0;if(d)return!0;for(var N=0;N!==V.length+1;N++){var G=V[N%V.length],D=V[(N+1)%V.length];r.rotate(f,G,p),r.rotate(v,D,p),h(f,f,u),h(v,v,u),a(m,v,f),r.normalize(y,m),r.rotate90cw(g,y),a(F,i,f);c(F,g);a(C,f,u),a(P,i,u),r.sub(M,f,i);var U=Math.abs(r.dot(M,g));U<R&&(R=U,r.scale(T,g,U),r.add(T,T,i),r.copy(_,g),k=!0)}if(k){var j=this.createContactEquation(t,n,e,l);return r.scale(j.normalA,_,-1),r.normalize(j.normalA,j.normalA),r.set(j.contactPointA,0,0),h(j.contactPointA,j.contactPointA,i),a(j.contactPointA,j.contactPointA,t.position),a(j.contactPointB,T,u),h(j.contactPointB,j.contactPointB,u),a(j.contactPointB,j.contactPointB,n.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}return 0},o.prototype[m.CIRCLE]=o.prototype.circleCircle=function(t,e,i,o,n,s,c,l,u,p,d){var f=b,p=p||e.radius,d=d||s.radius;a(f,i,c);var v=p+d;if(r.squaredLength(f)>Math.pow(v,2))return 0;if(u)return!0;var m=this.createContactEquation(t,n,e,s);return a(m.normalA,c,i),r.normalize(m.normalA,m.normalA),r.scale(m.contactPointA,m.normalA,p),r.scale(m.contactPointB,m.normalA,-d),h(m.contactPointA,m.contactPointA,i),a(m.contactPointA,m.contactPointA,t.position),h(m.contactPointB,m.contactPointB,c),a(m.contactPointB,m.contactPointB,n.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},o.prototype[m.PLANE|m.CONVEX]=o.prototype[m.PLANE|m.BOX]=o.prototype.planeConvex=function(t,e,i,o,n,s,l,u,p){var d=b,f=A,v=w,m=0;r.rotate(f,g,o);for(var y=0;y!==s.vertices.length;y++){var E=s.vertices[y];if(r.rotate(d,E,u),h(d,d,l),a(v,d,i),c(v,f)<=0){if(p)return!0;m++;var x=this.createContactEquation(t,n,e,s);a(v,d,i),r.copy(x.normalA,f);var S=c(v,x.normalA);r.scale(v,x.normalA,S),a(x.contactPointB,d,n.position),a(x.contactPointA,d,v),a(x.contactPointA,x.contactPointA,t.position),this.contactEquations.push(x),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}return this.enableFrictionReduction&&this.enableFriction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},o.prototype[m.PARTICLE|m.PLANE]=o.prototype.particlePlane=function(t,e,i,o,n,s,h,l,u){var p=b,d=A;l=l||0,a(p,i,h),r.rotate(d,g,l);var f=c(p,d);if(f>0)return 0;if(u)return!0;var v=this.createContactEquation(n,t,s,e);return r.copy(v.normalA,d),r.scale(p,v.normalA,f),a(v.contactPointA,i,p),a(v.contactPointA,v.contactPointA,n.position),a(v.contactPointB,i,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},o.prototype[m.CIRCLE|m.PARTICLE]=o.prototype.circleParticle=function(t,e,i,o,n,s,c,l,u){var p=b;if(a(p,c,i),r.squaredLength(p)>Math.pow(e.radius,2))return 0;if(u)return!0;var d=this.createContactEquation(t,n,e,s);return r.copy(d.normalA,p),r.normalize(d.normalA,d.normalA),r.scale(d.contactPointA,d.normalA,e.radius),h(d.contactPointA,d.contactPointA,i),a(d.contactPointA,d.contactPointA,t.position),a(d.contactPointB,c,n.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var $=new f({radius:1}),K=r.create(),Z=r.create();r.create();o.prototype[m.PLANE|m.CAPSULE]=o.prototype.planeCapsule=function(t,e,i,o,n,s,a,c,l){var u=K,p=Z,d=$;r.set(u,-s.length/2,0),r.rotate(u,u,c),h(u,u,a),r.set(p,s.length/2,0),r.rotate(p,p,c),h(p,p,a),d.radius=s.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,d,u,0,t,e,i,o,l),m=this.circlePlane(n,d,p,0,t,e,i,o,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l)return v||m;var y=v+m;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},o.prototype[m.CIRCLE|m.PLANE]=o.prototype.circlePlane=function(t,e,i,o,n,s,l,u,p){var d=t,f=e,v=i,m=n,y=l,E=u;E=E||0;var x=b,S=A,B=w;a(x,v,y),r.rotate(S,g,E);var C=c(S,x);if(C>f.radius)return 0;if(p)return!0;var P=this.createContactEquation(m,d,s,e);return r.copy(P.normalA,S),r.scale(P.contactPointB,P.normalA,-f.radius),h(P.contactPointB,P.contactPointB,v),a(P.contactPointB,P.contactPointB,d.position),r.scale(B,P.normalA,C),a(P.contactPointA,x,B),h(P.contactPointA,P.contactPointA,y),a(P.contactPointA,P.contactPointA,m.position),this.contactEquations.push(P),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P)),1},o.prototype[m.CONVEX]=o.prototype[m.CONVEX|m.BOX]=o.prototype[m.BOX]=o.prototype.convexConvex=function(t,e,i,n,s,l,u,p,d,f){var v=b,m=A,y=w,g=E,S=x,q=B,F=C,T=P,L=0,f="number"==typeof f?f:0,M=o.findSeparatingAxis(e,i,n,l,u,p,v);if(!M)return 0;a(F,u,i),c(v,F)>0&&r.scale(v,v,-1);var _=o.getClosestEdge(e,n,v,!0),R=o.getClosestEdge(l,p,v);if(_===-1||R===-1)return 0;for(var I=0;I<2;I++){var O=_,k=R,V=e,N=l,G=i,D=u,U=n,j=p,z=t,X=s;if(0===I){var Y;Y=O,O=k,k=Y,Y=V,V=N,N=Y,Y=G,G=D,D=Y,Y=U,U=j,j=Y,Y=z,z=X,X=Y}for(var W=k;W<k+2;W++){var H=N.vertices[(W+N.vertices.length)%N.vertices.length];r.rotate(m,H,j),h(m,m,D);for(var $=0,K=O-1;K<O+2;K++){var Z=V.vertices[(K+V.vertices.length)%V.vertices.length],J=V.vertices[(K+1+V.vertices.length)%V.vertices.length];r.rotate(y,Z,U),r.rotate(g,J,U),h(y,y,G),h(g,g,G),a(S,g,y),r.rotate90cw(T,S),r.normalize(T,T),a(F,m,y);var Q=c(T,F);(K===O&&Q<=f||K!==O&&Q<=0)&&$++}if($>=3){if(d)return!0;var tt=this.createContactEquation(z,X,V,N);L++;var Z=V.vertices[O%V.vertices.length],J=V.vertices[(O+1)%V.vertices.length];r.rotate(y,Z,U),r.rotate(g,J,U),h(y,y,G),h(g,g,G),a(S,g,y),r.rotate90cw(tt.normalA,S),r.normalize(tt.normalA,tt.normalA),a(F,m,y);var Q=c(tt.normalA,F);r.scale(q,tt.normalA,Q),a(tt.contactPointA,m,G),a(tt.contactPointA,tt.contactPointA,q),h(tt.contactPointA,tt.contactPointA,G),a(tt.contactPointA,tt.contactPointA,z.position),a(tt.contactPointB,m,D),h(tt.contactPointB,tt.contactPointB,D),a(tt.contactPointB,tt.contactPointB,X.position),this.contactEquations.push(tt),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(tt))}}}return this.enableFrictionReduction&&this.enableFriction&&L&&this.frictionEquations.push(this.createFrictionFromAverage(L)),L};var J=r.fromValues(0,0);o.projectConvexOntoAxis=function(t,e,i,o,n){var s,a,h=null,l=null,u=J;r.rotate(u,o,-i);for(var p=0;p<t.vertices.length;p++)s=t.vertices[p],
a=c(s,u),(null===h||a>h)&&(h=a),(null===l||a<l)&&(l=a);if(l>h){var d=l;l=h,h=d}var f=c(e,o);r.set(n,l+f,h+f)};var Q=r.fromValues(0,0),tt=r.fromValues(0,0),et=r.fromValues(0,0),it=r.fromValues(0,0),ot=r.fromValues(0,0),nt=r.fromValues(0,0);o.findSeparatingAxis=function(t,e,i,n,s,h,c){var l=null,u=!1,p=!1,d=Q,f=tt,v=et,m=it,g=ot,b=nt;if(t instanceof y&&n instanceof y)for(var A=0;2!==A;A++){var w=t,E=i;1===A&&(w=n,E=h);for(var x=0;2!==x;x++){0===x?r.set(m,0,1):1===x&&r.set(m,1,0),0!==E&&r.rotate(m,m,E),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,s,h,m,b);var S=g,B=b,C=!1;g[0]>b[0]&&(B=g,S=b,C=!0);var P=B[0]-S[1];u=P<=0,(null===l||P>l)&&(r.copy(c,m),l=P,p=u)}}else for(var A=0;2!==A;A++){var w=t,E=i;1===A&&(w=n,E=h);for(var x=0;x!==w.vertices.length;x++){r.rotate(f,w.vertices[x],E),r.rotate(v,w.vertices[(x+1)%w.vertices.length],E),a(d,v,f),r.rotate90cw(m,d),r.normalize(m,m),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,s,h,m,b);var S=g,B=b,C=!1;g[0]>b[0]&&(B=g,S=b,C=!0);var P=B[0]-S[1];u=P<=0,(null===l||P>l)&&(r.copy(c,m),l=P,p=u)}}return p};var st=r.fromValues(0,0),rt=r.fromValues(0,0),at=r.fromValues(0,0);o.getClosestEdge=function(t,e,i,o){var n=st,s=rt,h=at;r.rotate(n,i,-e),o&&r.scale(n,n,-1);for(var l=-1,u=t.vertices.length,p=-1,d=0;d!==u;d++){a(s,t.vertices[(d+1)%u],t.vertices[d%u]),r.rotate90cw(h,s),r.normalize(h,h);var f=c(h,n);(l===-1||f>p)&&(l=d%u,p=f)}return l};var ht=r.create(),ct=r.create(),lt=r.create(),ut=r.create(),pt=r.create(),dt=r.create(),ft=r.create();o.prototype[m.CIRCLE|m.HEIGHTFIELD]=o.prototype.circleHeightfield=function(t,e,i,o,n,s,c,l,u,p){var d=s.heights,p=p||e.radius,f=s.elementWidth,v=ct,m=ht,y=pt,g=ft,b=dt,A=lt,w=ut,E=Math.floor((i[0]-p-c[0])/f),x=Math.ceil((i[0]+p-c[0])/f);E<0&&(E=0),x>=d.length&&(x=d.length-1);for(var S=d[E],B=d[x],C=E;C<x;C++)d[C]<B&&(B=d[C]),d[C]>S&&(S=d[C]);if(i[1]-p>S)return!u&&0;for(var P=!1,C=E;C<x;C++){r.set(A,C*f,d[C]),r.set(w,(C+1)*f,d[C+1]),r.add(A,A,c),r.add(w,w,c),r.sub(b,w,A),r.rotate(b,b,Math.PI/2),r.normalize(b,b),r.scale(m,b,-p),r.add(m,m,i),r.sub(v,m,A);var q=r.dot(v,b);if(m[0]>=A[0]&&m[0]<w[0]&&q<=0){if(u)return!0;P=!0,r.scale(v,b,-q),r.add(y,m,v),r.copy(g,b);var F=this.createContactEquation(n,t,s,e);r.copy(F.normalA,g),r.scale(F.contactPointB,F.normalA,-p),h(F.contactPointB,F.contactPointB,i),a(F.contactPointB,F.contactPointB,t.position),r.copy(F.contactPointA,y),r.sub(F.contactPointA,F.contactPointA,n.position),this.contactEquations.push(F),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(F))}}if(P=!1,p>0)for(var C=E;C<=x;C++)if(r.set(A,C*f,d[C]),r.add(A,A,c),r.sub(v,i,A),r.squaredLength(v)<Math.pow(p,2)){if(u)return!0;P=!0;var F=this.createContactEquation(n,t,s,e);r.copy(F.normalA,v),r.normalize(F.normalA,F.normalA),r.scale(F.contactPointB,F.normalA,-p),h(F.contactPointB,F.contactPointB,i),a(F.contactPointB,F.contactPointB,t.position),a(F.contactPointA,A,c),h(F.contactPointA,F.contactPointA,c),a(F.contactPointA,F.contactPointA,n.position),this.contactEquations.push(F),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(F))}return P?1:0};var vt=r.create(),mt=r.create(),yt=r.create(),gt=new v({vertices:[r.create(),r.create(),r.create(),r.create()]});o.prototype[m.BOX|m.HEIGHTFIELD]=o.prototype[m.CONVEX|m.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,i,o,n,s,a,h,c){var l=s.heights,u=s.elementWidth,p=vt,d=mt,f=yt,v=gt,m=Math.floor((t.aabb.lowerBound[0]-a[0])/u),y=Math.ceil((t.aabb.upperBound[0]-a[0])/u);m<0&&(m=0),y>=l.length&&(y=l.length-1);for(var g=l[m],b=l[y],A=m;A<y;A++)l[A]<b&&(b=l[A]),l[A]>g&&(g=l[A]);if(t.aabb.lowerBound[1]>g)return!c&&0;for(var w=0,A=m;A<y;A++){r.set(p,A*u,l[A]),r.set(d,(A+1)*u,l[A+1]),r.add(p,p,a),r.add(d,d,a);var E=100;r.set(f,.5*(d[0]+p[0]),.5*(d[1]+p[1]-E)),r.sub(v.vertices[0],d,f),r.sub(v.vertices[1],p,f),r.copy(v.vertices[2],v.vertices[1]),r.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=E,v.vertices[3][1]-=E,w+=this.convexConvex(t,e,i,o,n,v,f,0,c)}return w}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function o(t){t=t||{},this.from=t.from?s.fromValues(t.from[0],t.from[1]):s.create(),this.to=t.to?s.fromValues(t.to[0],t.to[1]):s.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(t){},this.direction=s.create(),this.length=1,this.update()}function n(t,e,i){s.sub(a,i,t);var o=s.dot(a,e);return s.scale(h,e,o),s.add(h,h,t),s.squaredDistance(i,h)}e.exports=o;var s=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");o.prototype.constructor=o,o.CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;s.sub(t,this.to,this.from),this.length=s.length(t),s.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var i=0,o=e.length;!t.shouldStop(this)&&i<o;i++){var n=e[i],s=n.getAABB();(s.overlapsRay(this)>=0||s.containsPoint(this.from))&&this.intersectBody(t,n)}};var r=s.create();o.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var o=r,n=0,a=e.shapes.length;n<a;n++){var h=e.shapes[n];if((!i||h.collisionResponse)&&0!==(this.collisionGroup&h.collisionMask)&&0!==(h.collisionGroup&this.collisionMask)){s.rotate(o,h.position,e.angle),s.add(o,o,e.position);var c=h.angle+e.angle;if(this.intersectShape(t,h,c,o,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,i,o,s){var r=this.from,a=n(r,this.direction,o);a>e.boundingRadius*e.boundingRadius||(this._currentBody=s,this._currentShape=e,e.raycast(t,this,o,i),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,i=this.from;s.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),s.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};s.create();o.prototype.reportIntersection=function(t,e,i,n){var r=(this.from,this.to,this._currentShape),a=this._currentBody;if(!(this.skipBackfaces&&s.dot(i,this.direction)>0))switch(this.mode){case o.ALL:t.set(i,r,a,e,n),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,r,a,e,n);break;case o.ANY:t.set(i,r,a,e,n)}};var a=s.create(),h=s.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function o(){this.normal=n.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var n=t("../math/vec2"),s=t("../collision/Ray");e.exports=o,o.prototype.reset=function(){n.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return n.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return this.fraction!==-1},o.prototype.getHitPoint=function(t,e){n.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===s.ANY},o.prototype.set=function(t,e,i,o,s){n.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=o,this.faceIndex=s}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function o(){s.call(this,s.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);i!==-1&&t.axisList.splice(i,1)}}var n=t("../utils/Utils"),s=t("../collision/Broadphase");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,n.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e=0|e;for(var i=1,o=t.length;i<o;i++){for(var n=t[i],s=i-1;s>=0&&!(t[s].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=n}return t},o.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;o.sortAxisList(t,e)},o.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,o=this.axisIndex;i.length=0;for(var n=e.length;n--;){var r=e[n];r.aabbNeedsUpdate&&r.updateAABB()}this.sortList();for(var a=0,h=0|e.length;a!==h;a++)for(var c=e[a],l=a+1;l<h;l++){var u=e[l],p=u.aabb.lowerBound[o]<=c.aabb.upperBound[o];if(!p)break;s.canCollide(c,u)&&this.boundingVolumeCheck(c,u)&&i.push(c,u)}return i},o.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var o=this.axisIndex,n="x";1===o&&(n="y"),2===o&&(n="z");for(var s=this.axisList,r=(e.lowerBound[n],e.upperBound[n],0);r<s.length;r++){var a=s[r];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&i.push(a)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function o(t,e,i,o){this.type=i,o=n.defaults(o,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=o.collideConnected,o.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=o;var n=t("../utils/Utils");o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.stiffness=t,o.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.relaxation=t,o.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function o(t,e,i){i=a.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),n.call(this,t,e,n.DISTANCE,i),this.localAnchorA=r.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=r.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var o=this.localAnchorA,h=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var c=r.create(),l=r.create(),u=r.create();r.rotate(c,o,t.angle),r.rotate(l,h,e.angle),r.add(u,e.position,l),r.sub(u,u,c),r.sub(u,u,t.position),this.distance=r.length(u)}var p;p="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce;var d=new s(t,e,(-p),p);this.equations=[d],this.maxForce=p;var u=r.create(),f=r.create(),v=r.create(),m=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,n=e.position;return r.rotate(f,o,t.angle),r.rotate(v,h,e.angle),r.add(u,n,v),r.sub(u,u,f),r.sub(u,u,i),r.length(u)-m.distance},this.setMaxForce(p),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var n=t("./Constraint"),s=t("../equations/Equation"),r=t("../math/vec2"),a=t("../utils/Utils");e.exports=o,o.prototype=new n,o.prototype.constructor=o;var h=r.create(),c=r.create(),l=r.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,o=(this.distance,e.position),n=i.position,s=this.equations[0],a=t.G;r.rotate(c,this.localAnchorA,e.angle),r.rotate(l,this.localAnchorB,i.angle),r.add(h,n,l),r.sub(h,h,c),r.sub(h,h,o),this.position=r.length(h);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u)return void(s.enabled=!1);s.enabled=!0,r.normalize(h,h);var p=r.crossLength(c,h),d=r.crossLength(l,h);a[0]=-h[0],a[1]=-h[1],a[2]=-p,a[3]=h[0],a[4]=h[1],a[5]=d},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,n.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new s(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var n=t("./Constraint"),s=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,n.LOCK,i);var o="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce,a=(i.localAngleB||0,new r(t,e,(-o),o)),h=new r(t,e,(-o),o),c=new r(t,e,(-o),o),l=s.create(),u=s.create(),p=this;a.computeGq=function(){return s.rotate(l,p.localOffsetB,t.angle),s.sub(u,e.position,t.position),s.sub(u,u,l),u[0]},h.computeGq=function(){return s.rotate(l,p.localOffsetB,t.angle),s.sub(u,e.position,t.position),s.sub(u,u,l),u[1]};var d=s.create(),f=s.create();c.computeGq=function(){return s.rotate(d,p.localOffsetB,e.angle-p.localAngleB),s.scale(d,d,-1),s.sub(u,t.position,e.position),s.add(u,u,d),s.rotate(f,d,-Math.PI/2),s.normalize(f,f),s.dot(u,f)},this.localOffsetB=s.create(),i.localOffsetB?s.copy(this.localOffsetB,i.localOffsetB):(s.sub(this.localOffsetB,e.position,t.position),s.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(a,h,c),this.setMaxForce(o)}var n=t("./Constraint"),s=t("../math/vec2"),r=t("../equations/Equation");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=s.create(),h=s.create(),c=s.create(),l=s.fromValues(1,0),u=s.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],o=this.bodyA,n=this.bodyB;s.rotate(a,this.localOffsetB,o.angle),s.rotate(h,this.localOffsetB,n.angle-this.localAngleB),s.scale(h,h,-1),s.rotate(c,h,Math.PI/2),s.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-s.crossLength(a,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-s.crossLength(a,u),e.G[4]=1,i.G[0]=-c[0],i.G[1]=-c[1],i.G[3]=c[0],i.G[4]=c[1],i.G[5]=s.crossLength(h,c)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,n.PRISMATIC,i);var o=a.fromValues(0,0),c=a.fromValues(1,0),l=a.fromValues(0,0);i.localAnchorA&&a.copy(o,i.localAnchorA),i.localAxisA&&a.copy(c,i.localAxisA),i.localAnchorB&&a.copy(l,i.localAnchorB),this.localAnchorA=o,this.localAnchorB=l,this.localAxisA=c;var u=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE,p=new r(t,e,(-u),u),d=new a.create,f=new a.create,v=new a.create,m=new a.create;if(p.computeGq=function(){return a.dot(v,m)},p.updateJacobian=function(){var i=this.G,n=t.position,s=e.position;a.rotate(d,o,t.angle),a.rotate(f,l,e.angle),a.add(v,s,f),a.sub(v,v,n),a.sub(v,v,d),a.rotate(m,c,t.angle+Math.PI/2),i[0]=-m[0],i[1]=-m[1],i[2]=-a.crossLength(d,m)+a.crossLength(m,v),i[3]=m[0],i[4]=m[1],i[5]=a.crossLength(f,m)},this.equations.push(p),!i.disableRotationalLock){var y=new h(t,e,(-u),u);this.equations.push(y)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof i.lowerLimit,this.upperLimitEnabled="undefined"!=typeof i.upperLimit,this.lowerLimit="undefined"!=typeof i.lowerLimit?i.lowerLimit:0,this.upperLimit="undefined"!=typeof i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new s(t,e),this.lowerLimitEquation=new s(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.motorSpeed=0;var g=this,b=this.motorEquation;b.computeGW;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,s=e.angularVelocity,r=i.angularVelocity;return this.gmult(t,o,s,n,r)+g.motorSpeed}}var n=t("./Constraint"),s=t("../equations/ContactEquation"),r=t("../equations/Equation"),a=t("../math/vec2"),h=t("../equations/RotationalLockEquation");e.exports=o,o.prototype=new n,o.prototype.constructor=o;var c=a.create(),l=a.create(),u=a.create(),p=a.create(),d=a.create(),f=a.create();o.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,o=this.lowerLimit,n=this.upperLimitEquation,s=this.lowerLimitEquation,r=this.bodyA,h=this.bodyB,v=this.localAxisA,m=this.localAnchorA,y=this.localAnchorB;e.updateJacobian(),a.rotate(c,v,r.angle),a.rotate(p,m,r.angle),a.add(l,p,r.position),a.rotate(d,y,h.angle),a.add(u,d,h.position);var g=this.position=a.dot(u,c)-a.dot(l,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=a.crossLength(c,d),b[3]=-c[0],b[4]=-c[1],b[5]=-a.crossLength(c,p)}if(this.upperLimitEnabled&&g>i)a.scale(n.normalA,c,-1),a.sub(n.contactPointA,l,r.position),a.sub(n.contactPointB,u,h.position),a.scale(f,c,i),a.add(n.contactPointA,n.contactPointA,f),t.indexOf(n)===-1&&t.push(n);else{var A=t.indexOf(n);A!==-1&&t.splice(A,1)}if(this.lowerLimitEnabled&&g<o)a.scale(s.normalA,c,1),a.sub(s.contactPointA,l,r.position),a.sub(s.contactPointB,u,h.position),a.scale(f,c,o),a.sub(s.contactPointB,s.contactPointB,f),t.indexOf(s)===-1&&t.push(s);else{var A=t.indexOf(s);A!==-1&&t.splice(A,1)}},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,n.REVOLUTE,i);var o=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=h.create(),this.pivotB=h.create(),i.worldPivot?(h.sub(this.pivotA,i.worldPivot,t.position),h.sub(this.pivotB,i.worldPivot,e.position),h.rotate(this.pivotA,this.pivotA,-t.angle),h.rotate(this.pivotB,this.pivotB,-e.angle)):(h.copy(this.pivotA,i.localPivotA),h.copy(this.pivotB,i.localPivotB));var f=this.equations=[new s(t,e,(-o),o),new s(t,e,(-o),o)],v=f[0],m=f[1],y=this;v.computeGq=function(){return h.rotate(c,y.pivotA,t.angle),h.rotate(l,y.pivotB,e.angle),h.add(d,e.position,l),h.sub(d,d,t.position),h.sub(d,d,c),h.dot(d,u)},m.computeGq=function(){return h.rotate(c,y.pivotA,t.angle),h.rotate(l,y.pivotB,e.angle),h.add(d,e.position,l),h.sub(d,d,t.position),h.sub(d,d,c),h.dot(d,p)},m.minForce=v.minForce=-o,m.maxForce=v.maxForce=o,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var n=t("./Constraint"),s=t("../equations/Equation"),r=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),h=t("../math/vec2");e.exports=o;var c=h.create(),l=h.create(),u=h.fromValues(1,0),p=h.fromValues(0,1),d=h.create();o.prototype=new n,o.prototype.constructor=o,o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,o=this.pivotB,n=this.equations,s=(n[0],n[1],n[0]),r=n[1],a=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,v=this.lowerLimitEquation,m=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&m>a)f.angle=a,n.indexOf(f)===-1&&n.push(f);else{var y=n.indexOf(f);y!==-1&&n.splice(y,1)}if(this.lowerLimitEnabled&&m<d)v.angle=d,n.indexOf(v)===-1&&n.push(v);else{var y=n.indexOf(v);y!==-1&&n.splice(y,1)}h.rotate(c,i,t.angle),h.rotate(l,o,e.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-h.crossLength(c,u),s.G[3]=1,s.G[4]=0,s.G[5]=h.crossLength(l,u),r.G[0]=0,r.G[1]=-1,r.G[2]=-h.crossLength(c,p),r.G[3]=0,r.G[4]=1,r.G[5]=h.crossLength(l,p)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var n=t("./Equation");t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function o(t,e){n.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=s.create(),this.penetrationVec=s.create(),this.contactPointB=s.create(),this.normalA=s.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var n=t("./Equation"),s=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeB=function(t,e,i){var o=this.bodyA,n=this.bodyB,r=this.contactPointA,a=this.contactPointB,h=o.position,c=n.position,l=this.penetrationVec,u=this.normalA,p=this.G,d=s.crossLength(r,u),f=s.crossLength(a,u);p[0]=-u[0],p[1]=-u[1],p[2]=-d,p[3]=u[0],p[4]=u[1],p[5]=f,s.add(l,c,a),s.sub(l,l,h),s.sub(l,l,r);var v,m;this.firstImpact&&0!==this.restitution?(m=0,v=1/e*(1+this.restitution)*this.computeGW()):(m=s.dot(u,l)+this.offset,v=this.computeGW());var y=this.computeGiMf(),g=-m*t-v*e-i*y;return g};var r=s.create(),a=s.create(),h=s.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(r,this.contactPointA),this.bodyB.getVelocityAtPoint(a,this.contactPointB),s.subtract(h,r,a),s.dot(this.normalA,h)}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function o(t,e,i,n){this.minForce="undefined"==typeof i?-Number.MAX_VALUE:i,this.maxForce="undefined"==typeof n?Number.MAX_VALUE:n,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new s.ARRAY_TYPE(6);for(var r=0;r<6;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=o;var n=t("../math/vec2"),s=t("../utils/Utils");t("../objects/Body");o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,i,o,n){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*o[0]+t[4]*o[1]+t[5]*n},o.prototype.computeB=function(t,e,i){var o=this.computeGW(),n=this.computeGq(),s=this.computeGiMf();return-n*t-o*e-s*i};var r=n.create(),a=n.create();o.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=(e.position,i.position,e.angle),n=i.angle;return this.gmult(t,r,o,a,n)+this.offset},o.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,s=e.angularVelocity,r=i.angularVelocity;return this.gmult(t,o,s,n,r)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.vlambda,n=i.vlambda,s=e.wlambda,r=i.wlambda;return this.gmult(t,o,s,n,r)};var h=n.create(),c=n.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,o=t.angularForce,s=e.force,r=e.angularForce,a=t.invMassSolve,l=e.invMassSolve,u=t.invInertiaSolve,p=e.invInertiaSolve,d=this.G;return n.scale(h,i,a),n.multiply(h,t.massMultiplier,h),n.scale(c,s,l),n.multiply(c,e.massMultiplier,c),this.gmult(d,h,o*u,c,r*p)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,o=e.invMassSolve,n=t.invInertiaSolve,s=e.invInertiaSolve,r=this.G;return r[0]*r[0]*i*t.massMultiplier[0]+r[1]*r[1]*i*t.massMultiplier[1]+r[2]*r[2]*n+r[3]*r[3]*o*e.massMultiplier[0]+r[4]*r[4]*o*e.massMultiplier[1]+r[5]*r[5]*s};var l=n.create(),u=n.create(),p=n.create();n.create(),n.create(),n.create();o.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,o=l,s=u,r=p,a=e.invMassSolve,h=i.invMassSolve,c=e.invInertiaSolve,d=i.invInertiaSolve,f=this.G;s[0]=f[0],s[1]=f[1],r[0]=f[3],r[1]=f[4],n.scale(o,s,a*t),n.multiply(o,o,e.massMultiplier),n.add(e.vlambda,e.vlambda,o),e.wlambda+=c*f[2]*t,n.scale(o,r,h*t),n.multiply(o,o,i.massMultiplier),n.add(i.vlambda,i.vlambda,o),i.wlambda+=d*f[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function o(t,e,i){s.call(this,t,e,-i,i),this.contactPointA=n.create(),this.contactPointB=n.create(),this.t=n.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var n=t("../math/vec2"),s=t("./Equation");t("../utils/Utils");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,i){var o=(this.bodyA,this.bodyB,this.contactPointA),s=this.contactPointB,r=this.t,a=this.G;a[0]=-r[0],a[1]=-r[1],a[2]=-n.crossLength(o,r),a[3]=r[0],a[4]=r[1],a[5]=n.crossLength(s,r);var h=this.computeGW(),c=this.computeGiMf(),l=-h*e-i*c;return l}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var o=this.G;o[2]=1,o[5]=-1}var n=t("./Equation"),s=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o;var r=s.create(),a=s.create(),h=s.fromValues(1,0),c=s.fromValues(0,1);o.prototype.computeGq=function(){return s.rotate(r,h,this.bodyA.angle+this.angle),s.rotate(a,c,this.bodyB.angle),s.dot(r,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function o(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var n=t("./Equation");t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeB=function(t,e,i){var o=this.G;o[2]=-1,o[5]=this.ratio;var n=this.computeGiMf(),s=this.computeGW(),r=-s*e-i*n;return r}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var o=function(){};e.exports=o,o.prototype={constructor:o,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),o[t].indexOf(e)===-1&&o[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&i[t].indexOf(e)!==-1)return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,o=i[t].indexOf(e);return o!==-1&&i[t].splice(o,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var o=0,n=i.length;o<n;o++){var s=i[o];s.call(s.context,t)}}return this}}},{}],27:[function(t,e,i){function o(t,e,i){if(i=i||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof i.friction?Number(i.friction):.3,this.restitution="undefined"!=typeof i.restitution?Number(i.restitution):0,this.stiffness="undefined"!=typeof i.stiffness?Number(i.stiffness):s.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof i.relaxation?Number(i.relaxation):s.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof i.frictionStiffness?Number(i.frictionStiffness):s.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof i.frictionRelaxation?Number(i.frictionRelaxation):s.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var n=t("./Material"),s=t("../equations/Equation");e.exports=o,o.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function o(t){this.id=t||o.idCounter++}e.exports=o,o.idCounter=0},{}],29:[function(t,e,i){var o={};o.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,o=0;o<e;o+=2)i+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return i+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-i},o.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],s=0;s<e;s++)n.push(s);for(var s=0,r=e;r>3;){var a=n[(s+0)%r],h=n[(s+1)%r],c=n[(s+2)%r],l=t[2*a],u=t[2*a+1],p=t[2*h],d=t[2*h+1],f=t[2*c],v=t[2*c+1],m=!1;if(o._convex(l,u,p,d,f,v)){m=!0;for(var y=0;y<r;y++){var g=n[y];if(g!=a&&g!=h&&g!=c&&o._PointInTriangle(t[2*g],t[2*g+1],l,u,p,d,f,v)){m=!1;break}}}if(m)i.push(a,h,c),n.splice((s+1)%r,1),r--,s=0;else if(s++>3*r)break}return i.push(n[0],n[1],n[2]),i},o._PointInTriangle=function(t,e,i,o,n,s,r,a){var h=r-i,c=a-o,l=n-i,u=s-o,p=t-i,d=e-o,f=h*h+c*c,v=h*l+c*u,m=h*p+c*d,y=l*l+u*u,g=l*p+u*d,b=1/(f*y-v*v),A=(y*m-v*g)*b,w=(f*g-v*m)*b;return A>=0&&w>=0&&A+w<1},o._convex=function(t,e,i,o,n,s){return(e-o)*(n-i)+(i-t)*(s-o)>=0},e.exports=o},{}],30:[function(t,e,i){var o=e.exports={},n=t("../utils/Utils");o.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},o.crossVZ=function(t,e,i){return o.rotate(t,e,-Math.PI/2),o.scale(t,t,i),t},o.crossZV=function(t,e,i){return o.rotate(t,i,Math.PI/2),o.scale(t,t,e),t},o.rotate=function(t,e,i){if(0!==i){var o=Math.cos(i),n=Math.sin(i),s=e[0],r=e[1];t[0]=o*s-n*r,t[1]=n*s+o*r}else t[0]=e[0],t[1]=e[1]},o.rotate90cw=function(t,e){var i=e[0],o=e[1];t[0]=o,t[1]=-i},o.toLocalFrame=function(t,e,i,n){o.copy(t,e),o.sub(t,t,i),o.rotate(t,t,-n)},o.toGlobalFrame=function(t,e,i,n){o.copy(t,e),o.rotate(t,t,n),o.add(t,t,i)},o.vectorToLocalFrame=function(t,e,i){o.rotate(t,e,-i)},o.vectorToGlobalFrame=function(t,e,i){o.rotate(t,e,i)},o.centroid=function(t,e,i,n){return o.add(t,e,i),o.add(t,t,n),o.scale(t,t,1/3),t},o.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],
e[1]=t[1],e},o.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,i){return t[0]=e,t[1]=i,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},o.div=o.divide,o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},o.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(i*i+o*o)},o.dist=o.distance,o.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var i=e[0],o=e[1],n=i*i+o*o;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.lerp=function(t,e,i,o){var n=e[0],s=e[1];return t[0]=n+o*(i[0]-n),t[1]=s+o*(i[1]-s),t},o.reflect=function(t,e,i){var o=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*o,t[1]=e[1]-2*i[1]*o},o.getLineSegmentsIntersection=function(t,e,i,n,s){var r=o.getLineSegmentsIntersectionFraction(e,i,n,s);return!(r<0)&&(t[0]=e[0]+r*(i[0]-e[0]),t[1]=e[1]+r*(i[1]-e[1]),!0)},o.getLineSegmentsIntersectionFraction=function(t,e,i,o){var n,s,r=e[0]-t[0],a=e[1]-t[1],h=o[0]-i[0],c=o[1]-i[1];return n=(-a*(t[0]-i[0])+r*(t[1]-i[1]))/(-h*a+r*c),s=(h*(t[1]-i[1])-c*(t[0]-i[0]))/(-h*a+r*c),n>=0&&n<=1&&s>=0&&s<=1?s:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function o(t){t=t||{},l.call(this),this.id=t.id||++o._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=n.create(),this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.interpolatedPosition=n.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=n.fromValues(0,0),this.previousAngle=0,this.velocity=n.fromValues(0,0),t.velocity&&n.copy(this.velocity,t.velocity),this.vlambda=n.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=n.create(),t.force&&n.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=o.STATIC,"undefined"!=typeof t.type?this.type=t.type:t.mass?this.type=o.DYNAMIC:this.type=o.STATIC,this.boundingRadius=0,this.aabb=new c,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var n=t("../math/vec2"),s=t("poly-decomp"),r=t("../shapes/Convex"),a=t("../collision/RaycastResult"),h=t("../collision/Ray"),c=t("../collision/AABB"),l=t("../events/EventEmitter");e.exports=o,o.prototype=new l,o.prototype.constructor=o,o._idCounter=0,o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},o.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var u=new c,p=n.create();o.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=p,o=this.angle,s=0;s!==e;s++){var r=t[s],a=r.angle+o;n.rotate(i,r.position,o),n.add(i,i,this.position),r.computeAABB(u,i,a),0===s?this.aabb.copy(u):this.aabb.extend(u)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,o=0;o!==e;o++){var s=t[o],r=n.length(s.position),a=s.boundingRadius;r+a>i&&(i=r+a)}this.boundingRadius=i},o.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?n.copy(t.position,e):n.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return e!==-1&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,s=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;r<e;r++){var a=t[r],h=n.squaredLength(a.position),c=a.computeMomentOfInertia(i);s+=c+i*h}this.inertia=s,this.invInertia=s>0?1/s:0}this.invMass=1/this.mass,n.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};n.create();o.prototype.applyForce=function(t,e){if(n.add(this.force,this.force,t),e){var i=n.crossLength(e,t);this.angularForce+=i}};var d=n.create(),f=n.create(),v=n.create();o.prototype.applyForceLocal=function(t,e){e=e||v;var i=d,o=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyForce(i,o)};var m=n.create();o.prototype.applyImpulse=function(t,e){if(this.type===o.DYNAMIC){var i=m;if(n.scale(i,t,this.invMass),n.multiply(i,this.massMultiplier,i),n.add(this.velocity,i,this.velocity),e){var s=n.crossLength(e,t);s*=this.invInertia,this.angularVelocity+=s}}};var y=n.create(),g=n.create(),b=n.create();o.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=y,o=g;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyImpulse(i,o)},o.prototype.toLocalFrame=function(t,e){n.toLocalFrame(t,e,this.position,this.angle)},o.prototype.toWorldFrame=function(t,e){n.toGlobalFrame(t,e,this.position,this.angle)},o.prototype.vectorToLocalFrame=function(t,e){n.vectorToLocalFrame(t,e,this.angle)},o.prototype.vectorToWorldFrame=function(t,e){n.vectorToGlobalFrame(t,e,this.angle)},o.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var o=new s.Polygon;if(o.vertices=t,o.makeCCW(),"number"==typeof e.removeCollinearPoints&&o.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!o.isSimple())return!1;this.concavePath=o.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var a=[0,0];n.copy(a,this.concavePath[i]),this.concavePath[i]=a}var h;h=e.optimalDecomp?o.decomp():o.quickDecomp();for(var c=n.create(),i=0;i!==h.length;i++){for(var l=new r({vertices:h[i].vertices}),u=0;u!==l.vertices.length;u++){var a=l.vertices[u];n.sub(a,a,l.centerOfMass)}n.scale(c,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,c)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var A=(n.fromValues(0,0),n.fromValues(0,0)),w=n.fromValues(0,0),E=n.fromValues(0,0);o.prototype.adjustCenterOfMass=function(){var t=A,e=w,i=E,o=0;n.set(e,0,0);for(var s=0;s!==this.shapes.length;s++){var r=this.shapes[s];n.scale(t,r.position,r.area),n.add(e,e,t),o+=r.area}n.scale(i,e,1/o);for(var s=0;s!==this.shapes.length;s++){var r=this.shapes[s];n.sub(r.position,r.position,i)}n.add(this.position,this.position,i);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)n.sub(this.concavePath[s],this.concavePath[s],i);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){n.set(this.force,0,0),this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;n.set(e,0,0),t.wlambda=0},o.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;n.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},o.prototype.applyDamping=function(t){if(this.type===o.DYNAMIC){var e=this.velocity;n.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},o.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,t!==o.AWAKE&&this.emit(o.wakeUpEvent)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=0,this.angularForce=0,n.set(this.velocity,0,0),n.set(this.force,0,0),this.emit(o.sleepEvent)},o.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==o.SLEEPING){this.wantsToSleep=!1;var s=(this.sleepState,n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),r=Math.pow(this.sleepSpeedLimit,2);s>=r?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=i,this.sleepState=o.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},o.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var x=n.create(),S=n.create();o.prototype.integrate=function(t){var e=this.invMass,i=this.force,o=this.position,s=this.velocity;n.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),n.scale(x,i,t*e),n.multiply(x,this.massMultiplier,x),n.add(s,x,s),this.integrateToTimeOfImpact(t)||(n.scale(S,s,t),n.add(o,o,S),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var B=new a,C=new h({mode:h.ALL}),P=n.create(),q=n.create(),F=n.create(),T=n.create();o.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||n.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;n.normalize(P,this.velocity),n.scale(q,this.velocity,t),n.add(q,q,this.position),n.sub(F,q,this.position);var e,i=this.angularVelocity*t,o=n.length(F),s=1,r=this;if(B.reset(),C.callback=function(t){t.body!==r&&(e=t.body,t.getHitPoint(q,C),n.sub(F,q,r.position),s=n.length(F)/o,t.stop())},n.copy(C.from,this.position),n.copy(C.to,q),C.update(),this.world.raycast(B,C),!e)return!1;var a=this.angle;n.copy(T,this.position);for(var h=0,c=0,l=0,u=s;u>=c&&h<this.ccdIterations;){h++,l=(u-c)/2,n.scale(S,F,s),n.add(this.position,T,S),this.angle=a+i*s,this.updateAABB();var p=this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e);p?c=l:u=l}return s=l,n.copy(this.position,T),this.angle=a,n.scale(S,F,s),n.add(this.position,this.position,S),this.fixedRotation||(this.angle+=i*s),!0},o.prototype.getVelocityAtPoint=function(t,e){return n.crossVZ(t,e,this.angularVelocity),n.subtract(t,this.velocity,t),t},o.sleepyEvent={type:"sleepy"},o.sleepEvent={type:"sleep"},o.wakeUpEvent={type:"wakeup"},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function o(t,e,i){i=i||{},s.call(this,t,e,i),this.localAnchorA=n.fromValues(0,0),this.localAnchorB=n.fromValues(0,0),i.localAnchorA&&n.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&n.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var o=n.create(),r=n.create();this.getWorldAnchorA(o),this.getWorldAnchorB(r);var a=n.distance(o,r);this.restLength="number"==typeof i.restLength?i.restLength:a}var n=t("../math/vec2"),s=t("./Spring");t("../utils/Utils");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var r=n.create(),a=n.create(),h=n.create(),c=n.create(),l=n.create(),u=n.create(),p=n.create(),d=n.create(),f=n.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,o=this.bodyA,s=this.bodyB,v=r,m=a,y=h,g=c,b=f,A=l,w=u,E=p,x=d;this.getWorldAnchorA(A),this.getWorldAnchorB(w),n.sub(E,A,o.position),n.sub(x,w,s.position),n.sub(v,w,A);var S=n.len(v);n.normalize(m,v),n.sub(y,s.velocity,o.velocity),n.crossZV(b,s.angularVelocity,x),n.add(y,y,b),n.crossZV(b,o.angularVelocity,E),n.sub(y,y,b),n.scale(g,m,-t*(S-i)-e*n.dot(y,m)),n.sub(o.force,o.force,g),n.add(s.force,s.force,g);var B=n.crossLength(E,g),C=n.crossLength(x,g);o.angularForce-=B,s.angularForce+=C}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function o(t,e,i){i=i||{},n.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}var n=(t("../math/vec2"),t("./Spring"));e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,o=this.bodyA,n=this.bodyB,s=n.angle-o.angle,r=n.angularVelocity-o.angularVelocity,a=-t*(s-i)-e*r*0;o.angularForce-=a,n.angularForce+=a}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function o(t,e,i){i=n.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}var n=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function o(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new h({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function n(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=s.fromValues(0,1),e.localForwardVector&&s.copy(this.localForwardVector,e.localForwardVector),this.localPosition=s.fromValues(0,0),e.localPosition&&s.copy(this.localPosition,e.localPosition),r.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var s=t("../math/vec2"),r=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),h=t("../objects/Body");e.exports=o,o.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},o.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},o.prototype.addWheel=function(t){var e=new n(this,t);return this.wheels.push(e),e},o.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},n.prototype=new r,n.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},n.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=s.create(),l=s.create();n.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(l,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,l),s.dot(c,l)};var u=s.create();n.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),s.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),s.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),s.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),s.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),s.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),s.normalize(u,this.forwardEquation.t),s.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var o=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(o,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,o=[n.fromValues(-e/2,-i/2),n.fromValues(e/2,-i/2),n.fromValues(e/2,i/2),n.fromValues(-e/2,i/2)],a=[n.fromValues(1,0),n.fromValues(0,1)];t.vertices=o,t.axes=a,t.type=s.BOX,r.call(this,t)}var n=t("../math/vec2"),s=t("./Shape"),r=t("./Convex");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};n.create(),n.create(),n.create(),n.create();o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=n.CAPSULE,n.call(this,t)}var n=t("./Shape"),s=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,o=2*e;return t*(o*o+i*i)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=s.create();o.prototype.computeAABB=function(t,e,i){var o=this.radius;s.set(r,this.length/2,0),0!==i&&s.rotate(r,r,i),s.set(t.upperBound,Math.max(r[0]+o,-r[0]+o),Math.max(r[1]+o,-r[1]+o)),s.set(t.lowerBound,Math.min(r[0]-o,-r[0]-o),Math.min(r[1]-o,-r[1]-o)),s.add(t.lowerBound,t.lowerBound,e),s.add(t.upperBound,t.upperBound,e)};var a=s.create(),h=s.create(),c=s.create(),l=s.create(),u=s.fromValues(0,1);o.prototype.raycast=function(t,e,i,o){for(var n=e.from,r=e.to,p=(e.direction,a),d=h,f=c,v=l,m=this.length/2,y=0;y<2;y++){var g=this.radius*(2*y-1);s.set(f,-m,g),s.set(v,m,g),s.toGlobalFrame(f,f,i,o),s.toGlobalFrame(v,v,i,o);var b=s.getLineSegmentsIntersectionFraction(n,r,f,v);if(b>=0&&(s.rotate(d,u,o),s.scale(d,d,2*y-1),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}for(var A=Math.pow(this.radius,2)+Math.pow(m,2),y=0;y<2;y++){s.set(f,m*(2*y-1),0),s.toGlobalFrame(f,f,i,o);var w=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),E=2*((r[0]-n[0])*(n[0]-f[0])+(r[1]-n[1])*(n[1]-f[1])),x=Math.pow(n[0]-f[0],2)+Math.pow(n[1]-f[1],2)-Math.pow(this.radius,2),b=Math.pow(E,2)-4*w*x;if(!(b<0))if(0===b){if(s.lerp(p,n,r,b),s.squaredDistance(p,i)>A&&(s.sub(d,p,f),s.normalize(d,d),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}else{var S=Math.sqrt(b),B=1/(2*w),C=(-E-S)*B,P=(-E+S)*B;if(C>=0&&C<=1&&(s.lerp(p,n,r,C),s.squaredDistance(p,i)>A&&(s.sub(d,p,f),s.normalize(d,d),e.reportIntersection(t,C,d,-1),t.shouldStop(e))))return;if(P>=0&&P<=1&&(s.lerp(p,n,r,P),s.squaredDistance(p,i)>A&&(s.sub(d,p,f),s.normalize(d,d),e.reportIntersection(t,P,d,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function o(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=n.CIRCLE,n.call(this,t)}var n=t("./Shape"),s=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e,i){var o=this.radius;s.set(t.upperBound,o,o),s.set(t.lowerBound,-o,-o),e&&(s.add(t.lowerBound,t.lowerBound,e),s.add(t.upperBound,t.upperBound,e))};var r=s.create(),a=s.create();o.prototype.raycast=function(t,e,i,o){var n=e.from,h=e.to,c=this.radius,l=Math.pow(h[0]-n[0],2)+Math.pow(h[1]-n[1],2),u=2*((h[0]-n[0])*(n[0]-i[0])+(h[1]-n[1])*(n[1]-i[1])),p=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)-Math.pow(c,2),d=Math.pow(u,2)-4*l*p,f=r,v=a;if(!(d<0))if(0===d)s.lerp(f,n,h,d),s.sub(v,f,i),s.normalize(v,v),e.reportIntersection(t,d,v,-1);else{var m=Math.sqrt(d),y=1/(2*l),g=(-u-m)*y,b=(-u+m)*y;if(g>=0&&g<=1&&(s.lerp(f,n,h,g),s.sub(v,f,i),s.normalize(v,v),e.reportIntersection(t,g,v,-1),t.shouldStop(e)))return;b>=0&&b<=1&&(s.lerp(f,n,h,b),s.sub(v,f,i),s.normalize(v,v),e.reportIntersection(t,b,v,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function o(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var o=s.create();s.copy(o,e[i]),this.vertices.push(o)}if(this.axes=[],t.axes)for(var i=0;i<t.axes.length;i++){var r=s.create();s.copy(r,t.axes[i]),this.axes.push(r)}else for(var i=0;i<this.vertices.length;i++){var a=this.vertices[i],h=this.vertices[(i+1)%this.vertices.length],c=s.create();s.sub(c,h,a),s.rotate90cw(c,c),s.normalize(c,c),this.axes.push(c)}if(this.centerOfMass=s.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=n.CONVEX,n.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var n=t("./Shape"),s=t("../math/vec2"),r=t("../math/polyk");t("poly-decomp");e.exports=o,o.prototype=new n,o.prototype.constructor=o;var a=s.create(),h=s.create();o.prototype.projectOntoLocalAxis=function(t,e){for(var i,o,n=null,r=null,t=a,h=0;h<this.vertices.length;h++)i=this.vertices[h],o=s.dot(i,t),(null===n||o>n)&&(n=o),(null===r||o<r)&&(r=o);if(r>n){var c=r;r=n,n=c}s.set(e,r,n)},o.prototype.projectOntoWorldAxis=function(t,e,i,o){var n=h;this.projectOntoLocalAxis(t,o),0!==i?s.rotate(n,t,i):n=t;var r=s.dot(e,n);s.set(o,o[0]+r,o[1]+r)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var o=r.Triangulate(t),e=0;e<o.length;e+=3){var n=o[e],s=o[e+1],a=o[e+2];this.triangles.push([n,s,a])}};var c=s.create(),l=s.create(),u=s.create(),p=s.create(),d=s.create();s.create(),s.create(),s.create(),s.create();o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,n=c,r=u,a=p,h=d,f=l;s.set(i,0,0);for(var v=0,m=0;m!==t.length;m++){var y=t[m],r=e[y[0]],a=e[y[1]],h=e[y[2]];s.centroid(n,r,a,h);var g=o.triangleArea(r,a,h);v+=g,s.scale(f,n,g),s.add(i,i,f)}s.scale(i,i,1/v)},o.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,o=this.vertices.length,n=o-1,r=0;r<o;n=r,r++){var a=this.vertices[n],h=this.vertices[r],c=Math.abs(s.crossLength(a,h)),l=s.dot(h,h)+s.dot(h,a)+s.dot(a,a);e+=c*l,i+=c}return t/6*(e/i)},o.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var o=s.squaredLength(t[i]);o>e&&(e=o)}this.boundingRadius=Math.sqrt(e)},o.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],s=e[n[0]],r=e[n[1]],a=e[n[2]],h=o.triangleArea(s,r,a);this.area+=h}},o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var f=s.create(),v=s.create(),m=s.create();o.prototype.raycast=function(t,e,i,o){var n=f,r=v,a=m,h=this.vertices;s.toLocalFrame(n,e.from,i,o),s.toLocalFrame(r,e.to,i,o);for(var c=h.length,l=0;l<c&&!t.shouldStop(e);l++){var u=h[l],p=h[(l+1)%c],d=s.getLineSegmentsIntersectionFraction(n,r,u,p);d>=0&&(s.sub(a,p,u),s.rotate(a,a,-Math.PI/2+o),s.normalize(a,a),e.reportIntersection(t,d,a,l))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function o(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}var n=t("./Shape"),s=t("../math/vec2");t("../utils/Utils");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],o=0;o!==t.length;o++){var n=t[o];n>e&&(e=n),n<i&&(i=n)}this.maxValue=e,this.minValue=i},o.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var r=[s.create(),s.create(),s.create(),s.create()];o.prototype.computeAABB=function(t,e,i){s.set(r[0],0,this.maxValue),s.set(r[1],this.elementWidth*this.heights.length,this.maxValue),s.set(r[2],this.elementWidth*this.heights.length,this.minValue),s.set(r[3],0,this.minValue),t.setFromPoints(r,e,i)},o.prototype.getLineSegment=function(t,e,i){var o=this.heights,n=this.elementWidth;s.set(t,i*n,o[i]),s.set(e,(i+1)*n,o[i+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var a=(s.create(),s.create()),h=s.create(),c=s.create(),l=s.create(),u=s.create();s.fromValues(0,1);o.prototype.raycast=function(t,e,i,o){var n=e.from,r=e.to,p=(e.direction,a),d=h,f=c,v=l,m=u;s.toLocalFrame(v,n,i,o),s.toLocalFrame(m,r,i,o);var y=this.getClampedSegmentIndex(v),g=this.getClampedSegmentIndex(m);if(y>g){var b=y;y=g,g=b}for(var A=0;A<this.heights.length-1;A++){this.getLineSegment(d,f,A);var w=s.getLineSegmentsIntersectionFraction(v,m,d,f);if(w>=0&&(s.sub(p,f,d),s.rotate(p,p,o+Math.PI/2),s.normalize(p,p),e.reportIntersection(t,w,p,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function o(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=n.LINE,n.call(this,t)}var n=t("./Shape"),s=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var r=[s.create(),s.create()];o.prototype.computeAABB=function(t,e,i){var o=this.length/2;s.set(r[0],-o,0),s.set(r[1],o,0),t.setFromPoints(r,e,i,0)};var a=(s.create(),s.create()),h=s.create(),c=s.create(),l=s.fromValues(0,1);o.prototype.raycast=function(t,e,i,o){var n=e.from,r=e.to,u=h,p=c,d=this.length/2;s.set(u,-d,0),s.set(p,d,0),s.toGlobalFrame(u,u,i,o),s.toGlobalFrame(p,p,i,o);var f=s.getLineSegmentsIntersectionFraction(u,p,n,r);if(f>=0){var v=a;s.rotate(v,l,o),e.reportIntersection(t,f,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function o(t){
t=t||{},t.type=n.PARTICLE,n.call(this,t)}var n=t("./Shape"),s=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e,i){s.copy(t.lowerBound,e),s.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function o(t){t=t||{},t.type=n.PLANE,n.call(this,t)}var n=t("./Shape"),s=t("../math/vec2");t("../utils/Utils");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,i){var o=i%(2*Math.PI),n=s.set,r=1e7,a=t.lowerBound,h=t.upperBound;n(a,-r,-r),n(h,r,r),0===o?h[1]=0:o===Math.PI/2?a[0]=0:o===Math.PI?a[1]=0:o===3*Math.PI/2&&(h[0]=0)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var r=s.create(),a=(s.create(),s.create(),s.create()),h=s.create();o.prototype.raycast=function(t,e,i,o){var n=e.from,c=e.to,l=e.direction,u=r,p=a,d=h;s.set(p,0,1),s.rotate(p,p,o),s.sub(d,n,i);var f=s.dot(d,p);s.sub(d,c,i);var v=s.dot(d,p);if(!(f*v>0||s.squaredDistance(n,c)<f*f)){var m=s.dot(p,l);s.sub(u,n,i);var y=-s.dot(p,u)/m/e.length;e.reportIntersection(t,y,p,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function o(t){t=t||{},this.body=null,this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=o;var n=t("../math/vec2");o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,Object.defineProperty(o,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),o.BOX}}),o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype.computeMomentOfInertia=function(t){},o.prototype.updateBoundingRadius=function(){},o.prototype.updateArea=function(){},o.prototype.computeAABB=function(t,e,i){},o.prototype.raycast=function(t,e,i,o){}},{"../math/vec2":30}],46:[function(t,e,i){function o(t){r.call(this,t,r.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new a.ARRAY_TYPE(this.arrayStep),this.Bs=new a.ARRAY_TYPE(this.arrayStep),this.invCs=new a.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}function n(t){for(var e=t.length;e--;)t[e]=0}var s=t("../math/vec2"),r=t("./Solver"),a=t("../utils/Utils"),h=t("../equations/FrictionEquation");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.solve=function(t,e){this.sortEquations();var i=0,r=this.iterations,c=this.frictionIterations,l=this.equations,u=l.length,p=Math.pow(this.tolerance*u,2),d=e.bodies,f=e.bodies.length,v=(s.add,s.set,this.useZeroRHS),m=this.lambda;if(this.usedIterations=0,u)for(var y=0;y!==f;y++){var g=d[y];g.updateSolveMassProperties()}m.length<u&&(m=this.lambda=new a.ARRAY_TYPE(u+this.arrayStep),this.Bs=new a.ARRAY_TYPE(u+this.arrayStep),this.invCs=new a.ARRAY_TYPE(u+this.arrayStep)),n(m);for(var b=this.invCs,A=this.Bs,m=this.lambda,y=0;y!==l.length;y++){var w=l[y];(w.timeStep!==t||w.needsUpdate)&&(w.timeStep=t,w.update()),A[y]=w.computeB(w.a,w.b,t),b[y]=w.computeInvC(w.epsilon)}var w,E,y,x;if(0!==u){for(y=0;y!==f;y++){var g=d[y];g.resetConstraintVelocity()}if(c){for(i=0;i!==c;i++){for(E=0,x=0;x!==u;x++){w=l[x];var S=o.iterateEquation(x,w,w.epsilon,A,b,m,v,t,i);E+=Math.abs(S)}if(this.usedIterations++,E*E<=p)break}for(o.updateMultipliers(l,m,1/t),x=0;x!==u;x++){var B=l[x];if(B instanceof h){for(var C=0,P=0;P!==B.contactEquations.length;P++)C+=B.contactEquations[P].multiplier;C*=B.frictionCoefficient/B.contactEquations.length,B.maxForce=C,B.minForce=-C}}}for(i=0;i!==r;i++){for(E=0,x=0;x!==u;x++){w=l[x];var S=o.iterateEquation(x,w,w.epsilon,A,b,m,v,t,i);E+=Math.abs(S)}if(this.usedIterations++,E*E<=p)break}for(y=0;y!==f;y++)d[y].addConstraintVelocity();o.updateMultipliers(l,m,1/t)}},o.updateMultipliers=function(t,e,i){for(var o=t.length;o--;)t[o].multiplier=e[o]*i},o.iterateEquation=function(t,e,i,o,n,s,r,a,h){var c=o[t],l=n[t],u=s[t],p=e.computeGWlambda(),d=e.maxForce,f=e.minForce;r&&(c=0);var v=l*(c-p-i*u),m=u+v;return m<f*a?v=f*a-u:m>d*a&&(v=d*a-u),s[t]+=v,e.addToWlambda(v),v}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function o(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var n=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var s={bodies:[]};o.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),s.bodies.length=0,e.getBodies(s.bodies),s.bodies.length&&this.solve(t,s))},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var o=t[e];o.enabled&&this.equations.push(o)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);e!==-1&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1,o.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function o(){s.apply(this,arguments)}var n=t("../equations/ContactEquation"),s=t("./Pool");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function o(){s.apply(this,arguments)}var n=t("../equations/FrictionEquation"),s=t("./Pool");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function o(){s.apply(this,arguments)}var n=t("../world/IslandNode"),s=t("./Pool");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function o(){s.apply(this,arguments)}var n=t("../world/Island"),s=t("./Pool");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function o(){this.overlappingShapesLastState=new n,this.overlappingShapesCurrentState=new n,this.recordPool=new s({size:16}),this.tmpDict=new n,this.tmpArray1=[]}var n=t("./TupleDictionary"),s=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");e.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var o=t.keys[i],n=t.getByKey(o);e.getByKey(o);n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,i,o){var n=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!n.get(e.id,o.id)){var s=this.recordPool.get();s.set(t,e,i,o),n.set(e.id,o.id,s)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,o=i.keys.length;o--;){var n=i.keys[o],s=i.data[n];if(s.bodyA===t&&s.bodyB===e||s.bodyA===e&&s.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,i){var i=i||[],o=t,n=e;i.length=0;for(var s=n.keys.length;s--;){var r=n.keys[s],a=n.data[r];if(!a)throw new Error("Key "+r+" had no data!");var h=o.data[r];h||i.push(a)}return i},o.prototype.isNewOverlap=function(t,e){var i=0|t.id,o=0|e.id,n=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;return!n.get(i,o)&&!!s.get(i,o)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,o=t.length;o--;){var n=t[o];i.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(o=i.keys.length;o--;){var n=i.getByKey(i.keys[o]);n&&e.push(n.bodyA,n.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function o(t,e,i,o){this.shapeA=e,this.shapeB=o,this.bodyA=t,this.bodyB=i}e.exports=o,o.prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},{}],54:[function(t,e,i){function o(){s.apply(this,arguments)}var n=t("./OverlapKeeperRecord"),s=t("./Pool");e.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=o,o.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function o(){this.data={},this.keys=[]}var n=t("./Utils");e.exports=o,o.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t=0|t,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var o=this.getKey(t,e);return this.data[o]||this.keys.push(o),this.data[o]=i,o},o.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},o.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function o(){}e.exports=o,o.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,o=e.length;i!==o;++i)t.push(e[i])},o.splice=function(t,e,i){i=i||1;for(var o=e,n=t.length-i;o<n;o++)t[o]=t[o+i];t.length=n},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(t,e){for(var i in e)t[i]=e[i]},o.defaults=function(t,e){t=t||{};for(var i in e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function o(){this.equations=[],this.bodies=[]}var n=t("../objects/Body");e.exports=o,o.prototype.reset=function(){this.equations.length=this.bodies.length=0};var s=[];o.prototype.getBodies=function(t){var e=t||[],i=this.equations;s.length=0;for(var o=0;o!==i.length;o++){var n=i[o];s.indexOf(n.bodyA.id)===-1&&(e.push(n.bodyA),s.push(n.bodyA.id)),s.indexOf(n.bodyB.id)===-1&&(e.push(n.bodyB),s.push(n.bodyB.id))}return e},o.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===n.DYNAMIC&&!e.wantsToSleep)return!1}return!0},o.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},{"../objects/Body":31}],59:[function(t,e,i){function o(t){this.nodePool=new n({size:16}),this.islandPool=new s({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var n=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),s=t("./../utils/IslandPool"),r=t("../objects/Body");e.exports=o,o.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var o=t[i];if(!o.visited&&o.body.type===r.DYNAMIC)return o}return!1},o.prototype.visit=function(t,e,i){e.push(t.body);for(var o=t.equations.length,n=0;n!==o;n++){var s=t.equations[n];i.indexOf(s)===-1&&i.push(s)}},o.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var s,a=n.pop();s=o.getUnvisitedNode(a.neighbors);)s.visited=!0,this.visit(s,e,i),s.body.type===r.DYNAMIC&&n.push(s)},o.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var s=0;s!==e.length;s++){var r=this.nodePool.get();r.body=e[s],i.push(r)}for(var a=0;a!==n.length;a++){var h=n[a],s=e.indexOf(h.bodyA),c=e.indexOf(h.bodyB),l=i[s],u=i[c];l.neighbors.push(u),u.neighbors.push(l),l.equations.push(h),u.equations.push(h)}for(var p=this.islands,s=0;s<p.length;s++)this.islandPool.release(p[s]);p.length=0;for(var d;d=o.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(d,f.bodies,f.equations),p.push(f)}return p}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=o,o.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function o(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new y(this),this.islandManager=new A,this.gravity=s.fromValues(0,-9.78),t.gravity&&s.copy(this.gravity,t.gravity),this.frictionGravity=s.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new m,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"==typeof t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=o.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new b}var n=t("../solver/GSSolver"),s=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),r=t("../shapes/Circle"),a=t("../shapes/Convex"),h=(t("../shapes/Line"),t("../shapes/Plane")),c=t("../shapes/Capsule"),l=t("../shapes/Particle"),u=t("../events/EventEmitter"),p=t("../objects/Body"),d=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),f=t("../material/ContactMaterial"),v=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),m=t("../collision/SAPBroadphase"),y=t("../collision/Narrowphase"),g=t("../utils/Utils"),b=t("../utils/OverlapKeeper"),A=t("./IslandManager");t("../objects/RotationalSpring");e.exports=o,o.prototype=new Object(u.prototype),o.prototype.constructor=o,o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(t){this.constraints.push(t)},o.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},o.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);e!==-1&&g.splice(this.contactMaterials,e,1)},o.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,o=0,n=i.length;o!==n;o++){var s=i[o];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},o.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);e!==-1&&g.splice(this.constraints,e,1)};var w=(s.create(),s.create(),s.create(),s.create(),s.create(),s.create(),s.create()),E=s.fromValues(0,0),x=s.fromValues(0,0);s.fromValues(0,0),s.fromValues(0,0);o.prototype.step=function(t,e,i){if(i=i||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var o=0;this.accumulator>=t&&o<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,o++;for(var n=this.accumulator%t/t,r=0;r!==this.bodies.length;r++){var a=this.bodies[r];s.lerp(a.interpolatedPosition,a.previousPosition,a.position,n),a.interpolatedAngle=a.previousAngle+n*(a.angle-a.previousAngle)}}};var S=[];o.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,n=this.bodies,r=this.gravity,a=this.solver,h=this.bodies.length,c=this.broadphase,l=this.narrowphase,u=this.constraints,d=w,f=(s.scale,s.add),v=(s.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var m=s.length(this.gravity);0===m&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=m)}if(this.applyGravity)for(var y=0;y!==h;y++){var b=n[y],A=b.force;b.type===p.DYNAMIC&&b.sleepState!==p.SLEEPING&&(s.scale(d,r,b.mass*b.gravityScale),f(A,A,d))}if(this.applySpringForces)for(var y=0;y!==e;y++){var E=i[y];E.applyForce()}if(this.applyDamping)for(var y=0;y!==h;y++){var b=n[y];b.type===p.DYNAMIC&&b.applyDamping(t)}for(var x=c.getCollisionPairs(this),B=this.disabledBodyCollisionPairs,y=B.length-2;y>=0;y-=2)for(var C=x.length-2;C>=0;C-=2)(B[y]===x[C]&&B[y+1]===x[C+1]||B[y+1]===x[C]&&B[y]===x[C+1])&&x.splice(C,2);var P=u.length;for(y=0;y!==P;y++){var q=u[y];if(!q.collideConnected)for(var C=x.length-2;C>=0;C-=2)(q.bodyA===x[C]&&q.bodyB===x[C+1]||q.bodyB===x[C]&&q.bodyA===x[C+1])&&x.splice(C,2)}this.postBroadphaseEvent.pairs=x,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this);for(var y=0,F=x.length;y!==F;y+=2)for(var T=x[y],L=x[y+1],M=0,_=T.shapes.length;M!==_;M++)for(var R=T.shapes[M],I=R.position,O=R.angle,k=0,V=L.shapes.length;k!==V;k++){var N=L.shapes[k],G=N.position,D=N.angle,U=this.defaultContactMaterial;if(R.material&&N.material){var j=this.getContactMaterial(R.material,N.material);j&&(U=j)}this.runNarrowphase(l,T,R,I,O,L,N,G,D,U,this.frictionGravity)}for(var y=0;y!==h;y++){var z=n[y];z._wakeUpAfterNarrowphase&&(z.wakeUp(),z._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(S);for(var X=this.endContactEvent,k=S.length;k--;){var Y=S[k];X.shapeA=Y.shapeA,X.shapeB=Y.shapeB,X.bodyA=Y.bodyA,X.bodyB=Y.bodyB,this.emit(X)}S.length=0}var W=this.preSolveEvent;W.contactEquations=l.contactEquations,W.frictionEquations=l.frictionEquations,this.emit(W),W.contactEquations=W.frictionEquations=null;var P=u.length;for(y=0;y!==P;y++)u[y].update();if(l.contactEquations.length||l.frictionEquations.length||P)if(this.islandSplit){for(v.equations.length=0,g.appendArray(v.equations,l.contactEquations),g.appendArray(v.equations,l.frictionEquations),y=0;y!==P;y++)g.appendArray(v.equations,u[y].equations);v.split(this);for(var y=0;y!==v.islands.length;y++){var H=v.islands[y];H.equations.length&&a.solveIsland(t,H)}}else{for(a.addEquations(l.contactEquations),a.addEquations(l.frictionEquations),y=0;y!==P;y++)a.addEquations(u[y].equations);this.solveConstraints&&a.solve(t,this),a.removeAllEquations()}for(var y=0;y!==h;y++){var z=n[y];z.integrate(t)}for(var y=0;y!==h;y++)n[y].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var $=this.impactEvent,y=0;y!==l.contactEquations.length;y++){var K=l.contactEquations[y];K.firstImpact&&($.bodyA=K.bodyA,$.bodyB=K.bodyB,$.shapeA=K.shapeA,$.shapeB=K.shapeB,$.contactEquation=K,this.emit($))}if(this.sleepMode===o.BODY_SLEEPING)for(y=0;y!==h;y++)n[y].sleepTick(this.time,!1,t);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(y=0;y!==h;y++)n[y].sleepTick(this.time,!0,t);for(var y=0;y<this.islandManager.islands.length;y++){var H=this.islandManager.islands[y];H.wantsToSleep()&&H.sleep()}}this.stepping=!1;for(var Z=this.bodiesToBeRemoved,y=0;y!==Z.length;y++)this.removeBody(Z[y]);Z.length=0,this.emit(this.postStepEvent)},o.prototype.runNarrowphase=function(t,e,i,o,n,r,a,h,c,l,u){if(0!==(i.collisionGroup&a.collisionMask)&&0!==(a.collisionGroup&i.collisionMask)){s.rotate(E,o,e.angle),s.rotate(x,h,r.angle),s.add(E,E,e.position),s.add(x,x,r.position);var d=n+e.angle,f=c+r.angle;t.enableFriction=l.friction>0,t.frictionCoefficient=l.friction;var v;v=e.type===p.STATIC||e.type===p.KINEMATIC?r.mass:r.type===p.STATIC||r.type===p.KINEMATIC?e.mass:e.mass*r.mass/(e.mass+r.mass),t.slipForce=l.friction*u*v,t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&r.collisionResponse&&i.collisionResponse&&a.collisionResponse;var m=t[i.type|a.type],y=0;if(m){var g=i.sensor||a.sensor,b=t.frictionEquations.length;y=i.type<a.type?m.call(t,e,i,E,d,r,a,x,f,g):m.call(t,r,a,x,f,e,i,E,d,g);var A=t.frictionEquations.length-b;if(y){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&r.sleepState===p.AWAKE&&r.type!==p.STATIC){var w=s.squaredLength(r.velocity)+Math.pow(r.angularVelocity,2),S=Math.pow(r.sleepSpeedLimit,2);w>=2*S&&(e._wakeUpAfterNarrowphase=!0)}if(r.allowSleep&&r.type===p.DYNAMIC&&r.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var B=s.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),C=Math.pow(e.sleepSpeedLimit,2);B>=2*C&&(r._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,r,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,a)){var P=this.beginContactEvent;if(P.shapeA=i,P.shapeB=a,P.bodyA=e,P.bodyB=r,P.contactEquations.length=0,"number"==typeof y)for(var q=t.contactEquations.length-y;q<t.contactEquations.length;q++)P.contactEquations.push(t.contactEquations[q]);this.emit(P)}if("number"==typeof y&&A>1)for(var q=t.frictionEquations.length-A;q<t.frictionEquations.length;q++){var F=t.frictionEquations[q];F.setSlipForce(F.getSlipForce()/A)}}}}},o.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},o.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);e!==-1&&g.splice(this.springs,e,1)},o.prototype.addBody=function(t){if(this.bodies.indexOf(t)===-1){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},o.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);e!==-1&&(g.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},o.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var o=e[i];if(o.id===t)return o}return!1},o.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},o.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,o=0;o<i.length;o+=2)if(i[o]===t&&i[o+1]===e||i[o+1]===t&&i[o]===e)return void i.splice(o,2)},o.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;e>=0;e--)this.removeBody(i[e]);for(var n=this.springs,e=n.length-1;e>=0;e--)this.removeSpring(n[e]);for(var s=this.contactMaterials,e=s.length-1;e>=0;e--)this.removeContactMaterial(s[e]);o.apply(this)};var B=s.create(),C=(s.fromValues(0,0),s.fromValues(0,0));o.prototype.hitTest=function(t,e,i){i=i||0;var o=new p({position:t}),n=new l,u=t,d=0,f=B,v=C;o.addShape(n);for(var m=this.narrowphase,y=[],g=0,b=e.length;g!==b;g++)for(var A=e[g],w=0,E=A.shapes.length;w!==E;w++){var x=A.shapes[w];s.rotate(f,x.position,A.angle),s.add(f,f,A.position);var S=x.angle+A.angle;(x instanceof r&&m.circleParticle(A,x,f,S,o,n,u,d,!0)||x instanceof a&&m.particleConvex(o,n,u,d,A,x,f,S,!0)||x instanceof h&&m.particlePlane(o,n,u,d,A,x,f,S,!0)||x instanceof c&&m.particleCapsule(o,n,u,d,A,x,f,S,!0)||x instanceof l&&s.squaredLength(s.sub(v,f,t))<i*i)&&y.push(A)}return y},o.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var o=e[i],n=0;n!==o.equations.length;n++){var s=o.equations[n];s.stiffness=t,s.needsUpdate=!0}for(var r=this.contactMaterials,i=0;i!==r.length;i++){var o=r[i];o.stiffness=o.frictionStiffness=t}var o=this.defaultContactMaterial;o.stiffness=o.frictionStiffness=t},o.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],o=0;o!==i.equations.length;o++){var n=i.equations[o];n.relaxation=t,n.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var P=new v,q=[];o.prototype.raycast=function(t,e){return e.getAABB(P),this.broadphase.aabbQuery(this,P,q),e.intersectBodies(t,q),q.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),function(t){"use strict";function e(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!==i?i[2]:null}function i(t,e){return t.getBounds().intersects(e.getBounds())}var o=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,n={};n.toHex=function(t){if(/^(rgb|RGB)/.test(t)){for(var e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",n=0;n<e.length;n++){var s=Number(e[n]).toString(16);"0"===s&&(s+=s),i+=s}return 7!==i.length&&(i=t),i}if(!o.test(t))return t;var r=t.replace(/#/,"").split("");if(6===r.length)return t;if(3===r.length){for(var a="#",n=0;n<r.length;n+=1)a+=r[n]+r[n];return a}},n.toRgb=function(t,e){var i=t.toLowerCase();if(i&&o.test(i)){var n="rgb";if(4===i.length){for(var s="#",r=1;r<4;r+=1)s+=i.slice(r,r+1).concat(i.slice(r,r+1));i=s}for(var a=[],r=1;r<7;r+=2)a.push(parseInt("0x"+i.slice(r,r+2)));return"number"==typeof e&&(a.push(e),n="rgba"),n+"("+a.join(",")+")"}return i},t.Util=t.Util||{},t.extend(t.Util,{color:n,getParameter:e,hitTest:i})}(window.EC),function(t){"use strict";var e=Array.prototype.slice,i=function(){this.initialize.apply(this,arguments)};t.extend(i.prototype,{initialize:function(){return this._eventPool={},this},on:function(t,e,i){var o=this._eventPool;return(o[t]||(o[t]=[])).push({fn:e,ctx:i||this}),this},once:function(t,e,i){function o(){n.off(t,o),e.apply(this,arguments)}var n=this;return o._=e,this.on(t,o,i)},off:function(t,e){var i=this._eventPool,o=i[t],n=[];return o&&e&&(n=o.filter(function(t){return t.fn!==e&&t.fn._!==e})),n.length?i[t]=n:delete i[t],this},dispatch:function(t){var i=e.call(arguments,1),o=(this._eventPool[t]||[]).slice();return o.length&&o.forEach(function(t){t.fn.apply(t.ctx,i)}),this},success:function(t){return this.on("success",t)},complete:function(t){return this.on("complete",t)},error:function(t){return this.on("error",t)},progress:function(t){return this.on("progress",t)},clear:function(){return this._eventPool={},this}}),i.extend=t.classExtend,t.provide({Event:i})}(window.EC),function(t){"use strict";function e(t){EC.extend(f,t||{})}function i(t,e){var i=null;if(!e)var o=Date.now()+1e18*Math.random();if("object"==typeof t){i=[],e||(t._=o);for(var n in t)i.push(n+"="+t[n]);i=i.join("&")}else"string"==typeof t&&(i=t,e||(i+="&_="+o));return i}function o(t,e,i){return function(){return i&&t.apply(this,arguments),e.apply(this,arguments)}}function n(t){function e(e){r&&clearTimeout(r),o(f.success,t.success,t.global).call(t.context,"jsonp"===a?e:"xml"===a?s.responseXML:"json"===a?JSON.parse(s.responseText):s.responseText,s),o(f.complete,t.complete,t.global).call(t.context,s,s.status,s.statusText)}function n(){r&&clearTimeout(r),o(f.error,t.error,t.global).call(t.context,s,s.status,s.statusText),o(f.complete,t.complete,t.global).call(t.context,s,s.status,s.statusText)}t=EC.extend({},f,t||{});var s=t.xhr();if(s){var r,a=t.dataType.toLowerCase(),h=t.type.toUpperCase(),c=t.url,l=i(t.data,t.cache);if(!t.crossDomain){var u=document.createElement("a");u.href=t.url,t.crossDomain=v.protocol+"//"+v.host!=u.protocol+"//"+u.host}if(o(f.beforeSend,t.beforeSend,t.global).call(t.context,s)===!1)return s.abort(),n(),s;if(t.async&&t.timeout>0&&(r=setTimeout(function(){s.readyState<4&&(s.abort(),n())},t.timeout)),"GET"===h&&l&&(c+=c.indexOf("?")>-1?"&"+l:"?"+l,l=null),"jsonp"===a)return c+=(c.indexOf("?")>-1?"&":"?")+"callback="+t.callbackName,p(c,e,n),s;s.onload?(s.onload=function(){s.onload=new Function,e()},s.onerror=function(){s.onerror=new Function,n()}):s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<300||304===s.status?(s.onreadystatechange=new Function,e()):n())},s.open(h,c,t.async),t.cors&&(t.xhrFields.withCredentials=!0);for(var d in t.xhrFields)s[d]=t.xhrFields[d];t.crossDomain&&t.cors||(t.headers["X-Requested-With"]="XMLHttpRequest"),t.headers["Content-Type"]=t.contentType;for(var m in t.headers)s.setRequestHeader(m,t.headers[m]);return s.setRequestHeader("Accept",t.accepts[a]?t.accepts[a]+", */*; q=0.01":t.accepts._default),s.send(l),s}}var s=/^https?:\/\//,r={},a=function(t,e,i){var o=new Image;o.addEventListener("load",function t(){EC.isFunction(e)&&e(o),this.removeEventListener("load",t,!1)},!1),o.addEventListener("error",function e(){var o="fail load:"+t;console.error(o),EC.isFunction(i)&&i(o),this.removeEventListener("error",e,!1)},!1),o.src=t},h=EC.Event.extend({initialize:function(t){var e=this;return h.superclass.initialize.call(this),a(t,function(t){e.dispatch("success",t)},function(t){e.dispatch("error",t)}),this;
}}),c=function(e,i){var o=s.test(e.url)?e.url:t.baseUrl+e.url;a(o,function(t){r[e.name]={width:t.width,height:t.height,texture:t},EC.extend(r[e.name],e),EC.isFunction(i)&&i(e)})},l=function(t,e,i){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=t,n.onload=n.onreadystatechange=function(){n.onload=n.onreadystatechange=new Function,this.readyState&&!/loaded|complete/.test(this.readyState)||(n.parentNode.removeChild(n),"function"==typeof e&&e(n))},n.onerror=function(){n.onerror=new Function,"function"==typeof i&&i(null,404,"not found")},o.insertBefore(n,o.firstChild)},u=EC.Event.extend({initialize:function(t){var e=this;return u.superclass.initialize.call(this),l(t,function(t){e.dispatch("success",t)},function(t){e.dispatch("error",t)}),this}}),p=function(t,e,i){var o=/callback=([^&]+)/.exec(t);return o?(o=o[1],"?"===o&&(o="jsonp"+(Date.now()+1e18*Math.random()),t=t.replace("callback=?","callback="+o)),window[o]=function(t){e(t),delete window[o]},void l(t,null,i)):l(t,null,i)},d=EC.Event.extend({initialize:function(t){var e=this;return d.superclass.initialize.call(this),p(t,function(t){e.dispatch("success",t)},function(t){e.dispatch("error",t)}),this}}),f={url:"",type:"GET",async:!0,data:{},headers:{},xhrFields:{},cache:!0,cors:!1,global:!0,crossDomain:!1,beforeSend:EC.noop,success:EC.noop,error:EC.noop,complete:EC.noop,timeout:0,context:null,dataType:"text",callbackName:"?",contentType:"application/x-www-form-urlencoded;charset=UTF-8",xhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHttp")}catch(t){return null}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},v=document.createElement("a");v.href=window.location.href;var m=EC.Event.extend({initialize:function(t){var e=this;m.superclass.initialize.call(this);var i=t.success,o=t.error,s=t.complete;return t.success=function(){var t=[].slice.call(arguments);i&&i.apply(e,t),e.dispatch.apply(e,["success"].concat(t))},t.error=function(){var t=[].slice.call(arguments);o&&o.apply(e,t),e.dispatch.apply(e,["error"].concat(t))},t.complete=function(){var t=[].slice.call(arguments);s&&s.apply(e,t),e.dispatch.apply(e,["complete"].concat(t))},n(t),this},then:function(t,e){return t&&this.on("success",t),e&&this.on("error",e),this},always:function(t){return t&&this.on("complete",t),this}}),y=function(e,i,o){return e=s.test(e)?e:t.baseUrl+e,n({url:e,dataType:"json",success:i,error:function(){o.apply(null,arguments),console.error("fail load:"+e)}})},g=function(t,e){"object"==typeof t&&("image"===t.type?c(t,function(){e&&e(t)}):/^(?:json|sheet|font)$/.test(t.type)?y(t.url,function(i){var o=EC.extend({},t,{data:i});if(r[t.name]=o,"sheet"===t.type||"font"===t.type){var n=t.url.substr(0,t.url.lastIndexOf("/")+1)+i.file,s=i.file.replace(/\.(\w+)$/,"_$1"),a=EC.extend({},t,{url:n,name:s,type:"image"});c(a,function(){e&&e(o)})}else e&&e(o)}):(r[t.name]=t,e&&e(t)))},b=function(){return r},A=function(t,e){var i=/\[(\d+\-\d+)\]/,o=i.exec(t);if(o){for(var n=[],s=RegExp.$1.split("-"),a=t.replace(i,"").split("_"),h=Number(s[0]);h<Number(s[1])+1;h++){var c=a[0]+h+"_"+a[1];n.push(r[c])}return n}var l=r[t];if(void 0===l)return console.error(t+" does not exist!");if("json"===l.type||"sheet"===l.type){if(e){var u={},p=l.data.frames[e];return u.width=p.w,u.height=p.h,u.sx=p.x,u.sy=p.y,u.swidth=p.w,u.sheight=p.h,u.texture=l.texture,u}return l.data}return l},w=function(t){var e=A(t);return e?e.texture:null},E=function(t,e){if("string"!=typeof t)return t;if(!/^(#|\.)/.test(t))return null;var i=t.charAt(0);if(e=e||document,"#"===i)return document.getElementById(t.substr(1,t.length));if(document.querySelectorAll)return e.querySelectorAll(t);try{return e.getElementsByClassName(t)}catch(i){var o=[],n=e.getElementsByTagName("*");return n.forEach(function(e){(" "+e.className+" ").indexOf(" "+t+" ")>-1&&o.push(e)}),o}},x=function(t,e){var i=e.groups.find(function(e){return e.name===t});if(void 0===i)return console.error('group "'+t+'" dose not exsit!');var o=i.keys.split(",").map(function(t){return t.trim()});return o},S=function(t,e){var i=[];return t.forEach(function(t){e.indexOf(t.name)>-1&&i.push(t)}),i},B=EC.Event.extend({initialize:function(t,e){var i=x(t,e);if(void 0!==i){var o=S(e.resources,i),n=this,s=0,r=o.length;return B.superclass.initialize.call(this),o.forEach(function(t){g(t,function(){n.dispatch("progress",++s,r,t),s>r-1&&n.dispatch("complete")})}),this}}});EC.extend(t,{loadImage:function(t){return new h(t)},ajaxSetup:e,ajax:function(t){return n(t)},request:function(t){return new m(t)},loadScript:function(t){return new u(t)},loadJson:function(t){return new m({url:t,dataType:"json"})},loadJsonp:function(t){return new d(t)},loadGroup:function(t,e){return new B(t,e)},getAsset:b,getRes:A,getTexture:w,el:E,baseUrl:"images/"}),["get","post","getJSON"].forEach(function(e,i){t.request[e]=function(t,o){return e=e.replace(/JSON?$/,""),new m({url:t,type:e,data:o,dataType:2===i?"json":"text"})}})}(window.RES||(window.RES={})),function(t){"use strict";var e=t.Event.extend({initialize:function(){e.superclass.initialize.call(this),this.ticker=null},start:function(){var t=this;return+function e(){t.ticker=requestAnimationFrame(e),t.dispatch("ticker")}(),this},stop:function(){return this.ticker&&(cancelAnimationFrame(this.ticker),delete this.ticker),this}});t.provide({Ticker:e})}(window.EC),function(t){"use strict";var e=t.Event.extend({initialize:function(i,o){e.superclass.initialize.call(this),this._currentCount=0,this._lastTime=0,this._repeatCount=o,this._waitTime=0,this._ticker=new t.Ticker,this.delay=i,this._initEvents()},start:function(){return this._lastTime=Date.now(),this._ticker.start(),this},stop:function(){if(this._ticker)if(this._ticker.stop(),this._waitTime>0){var t=this;setTimeout(function(){t.dispatch("complete"),t.reset()},this._waitTime)}else this.dispatch("complete"),this.reset();return this},wait:function(t){return this._waitTime=t,this},pause:function(t){if(this._ticker&&(this._ticker.stop(),this.dispatch("pause")),"number"==typeof t&&t>0){var e=this;setTimeout(function(){e._ticker.start()},t)}return this},setRepeatCount:function(t){return this._repeatCount=t,this},_timerHandle:function(){var t=Date.now();if(t-this._lastTime>=this.delay){if(this._repeatCount&&++this._currentCount===this._repeatCount)return void this.stop();this._lastTime=t,this.dispatch("timer",t)}},_initEvents:function(){this._ticker.on("ticker",this._timerHandle,this)},reset:function(){return this._currentCount=0,this._ticker=null,this}});t.provide({Timer:e})}(window.EC),function(t){"use strict";var e={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-e.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*e.Bounce.In(2*t):.5*e.Bounce.Out(2*t-1)+.5}}};t.provide({Easing:e})}(window.EC),function(t){"use strict";var e=function(e,i){this.tweenObj=e,this._updateCb=[],this._completeCb=[],this.cfg=i||{},this._repeatIndex=0,this._repeatCount=0,this.cfg.reverse&&(this._repeatCount=2),this.cfg.loop&&(t.isNumber(this.cfg.loop)?this._repeatCount=this.cfg.loop:this._repeatCount=-1)};e.cache={},e.timerCache={},e.uuid=0,e.expando="@Tween-"+ +new Date,e.get=function(t,i){return new e(t,i)},e.removeTweens=function(t){return t&&t[e.expando]&&e.timerCache[t[e.expando]]&&e.get(t).stop(),this},e.removeAllTweens=function(t){return t.getChilds().forEach(function(t){e.removeTweens(t)}),this},e.prototype={to:function(){var t=this,e=arguments;return this.queue(function(){t.anim.apply(t,e)}),this},wait:function(e){return t.isNumber(e)&&this.queue(e),this},anim:function(i,o,n){var s,r=this,a=+new Date,h=e.timerCache[r.tweenObj[e.expando]];if(this.duration=o||600,this.easing=n||t.Easing.Linear.None,this.startAttrs=t.extend({},this.tweenObj),this.endAttrs=i,h)return this;var c=function(){s=(+new Date-a)/r.duration,s=s>=1?1:s,r.percent=s,h=requestAnimationFrame(c),e.timerCache[r.tweenObj[e.expando]]=h,r.update(r.tweenObj),1===s&&(r.stop(),r.dequeue())};return c(),this},update:function(t){for(var e in this.endAttrs)this.endAttrs[e]!==this.startAttrs[e]&&(t[e]=this.startAttrs[e]+(this.endAttrs[e]-this.startAttrs[e])*this.easing(this.percent));this._triggerUpdate(this.tweenObj)},stop:function(){return cancelAnimationFrame(e.timerCache[this.tweenObj[e.expando]]),delete e.timerCache[this.tweenObj[e.expando]],this},onUpdate:function(e,i){var o=this;return this._updateCb.push(function(){t.isFunction(e)&&e.apply(i||o,arguments)}),this},call:function(e,i){var o=this;return this._completeCb.push(function(){t.isFunction(e)&&e.apply(i||o,arguments)}),this},_triggerUpdate:function(t){this._updateCb.forEach(function(e){e(t)})},_triggerComplete:function(t){this._completeCb.forEach(function(e){e(t)})},queue:function(t){this.tweenObj[e.expando]||(this.tweenObj[e.expando]=++e.uuid);var i=e.cache[e.uuid];return void 0===i&&(i=e.cache[e.uuid]=[]),t&&i.push(t),"running"!==i[0]&&this.dequeue(),this},dequeue:function(){var i,o=this,n=e.cache[this.tweenObj[e.expando]]||[],s=n.shift();return"running"===s&&(s=n.shift()),s&&(n.unshift("running"),t.isNumber(s)?i=window.setTimeout(function(){window.clearTimeout(i),i=null,o.dequeue()},s):t.isFunction(s)&&s.call(o.tweenObj,function(){o.dequeue()})),n.length||(this._repeatCount===-1||++this._repeatIndex<this._repeatCount?this.to(this.startAttrs,this.duration,this.easing):delete e.cache[this.tweenObj[e.expando]],this._triggerComplete(this.tweenObj)),this},clearQueue:function(){return delete e.cache[this.tweenObj[e.expando]],this}},t.provide({Tween:e})}(window.EC),function(t,i){"use strict";function o(t,e){if(e.sx!==i){var o=t.canvas.width,n=t.canvas.height,s=e.swidth,r=e.sheight;s>=o&&(s=o-1),r>=n&&(r=n-1),t.drawImage(e.texture,e.sx,e.sy,s,r,0,0,e.width,e.height)}else t.drawImage(e.texture,0,0,e.width,e.height)}function n(t){var e,i,o=t.fontData.frames,n=t.fontTexture,s=0,r=0,a=t.width,h=t.x;t.children=[],t.width=t.height=0,t.$textArr.forEach(function(a){e=o[a],i=(new q).setParams({texture:n,width:e.w,height:e.h,sx:e.x,sy:e.y,x:s+=r+t.letterSpacing,swidth:e.w,sheight:e.h}),r=e.w,t.addChild(i)}),"center"===t.textAlign?t.x=h+(a-t.width)/2:"right"===t.textAlign&&(t.x=h+a-t.width)}function s(t,e){n(e),e.each(function(e){t.save(),p(t,e),o(t,e),t.restore()})}function r(t,e){t.font=e.font||e.textStyle+" "+e.textWeight+" "+e.size+"px "+e.fontFamily,t.textAlign=e.textAlign,t.textBaseline=e.textBaseline;var i="center"===e.textAlign?e.width/2:"right"===e.textAlign?e.width:0,o=0;e.strokeOnly||(t.fillStyle=e.textColor,a(t,"fillText",e,i,o)),(e.stroke||e.strokeOnly)&&(t.strokeStyle=e.strokeColor,a(t,"strokeText",e,i,o))}function a(t,e,i,o,n){var s=i.size+i.lineSpacing;i.$textArr.forEach(function(i,r){t[e](i,o,n+s*r)})}function h(t,e){for(var i=0,o=e.split(""),n=0;n<o.length;n++)"\n"!==o[n]?(i+=l(t,o[n]),i>t.width&&(i=0,o.splice(n,0,"\n"))):i=0;return o.join("")}function c(t){if(1===t.length)return t[0];var e=t.map(function(t){return t.length});return t[e.indexOf(v(e))]}function l(t,e){return S.font=t.font||t.textStyle+" "+t.textWeight+" "+t.size+"px "+t.fontFamily,S.textAlign=t.textAlign,S.measureText(e).width}function u(t,e){t.beginPath(),d(t,e),e.draw(t)}function p(e,i){var o=i.parent||{},n=i.moveX*(i.anchorX>0?1:0),s=i.moveY*(i.anchorY>0?1:0),r=i.anchorX*i.width,a=i.anchorY*i.height;i=i||{},t.isNumber(i.alpha)&&(e.globalAlpha=i.alpha),e.transform(i.scaleX,i.skewX,i.skewY,i.scaleY,i.x+n+r-(i.isMasker?0:o.mask?o.mask.x:0),i.y+s+a-(i.isMasker?0:o.mask?o.mask.y:0)),e.rotate(i.rotation*E),e.translate(-n-r,-s-a)}function d(t,e){if(t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,t.shadowColor=e.shadowColor,t.shadowBlur=e.shadowBlur||0,t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0,t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth||0,t.miterLimit=e.miterLimit,e.dashLength>0)try{t.setLineDash([e.dashLength,e.dashGap||e.dashLength])}catch(t){}}function f(t){return Math.min.apply(Math,t)}function v(t){return Math.max.apply(Math,t)}function m(t){var e=[],i=[];return t.forEach(function(t){e.push(t[0]),i.push(t[1])}),{width:v(e)-f(e),height:v(i)-f(i)}}function y(t){var e=[],i=[];return t.forEach(function(t,o){o%2===0?e.push(t):i.push(t)}),{width:v(e)-f(e),height:v(i)-f(i)}}function g(t,e){for(var i=t.x+(e?t.moveX:0),o=t.y+(e?t.moveY:0),n=t.parent;n;)i+=n.x,o+=n.y,n=n.parent;return{x:i,y:o}}function b(t,e){var i=g(e),o=e.renderContext,n=function(){};n.prototype=e;var s=new n;return s.x=i.x,s.y=i.y,o.save(),p(o,s),o.beginPath(),B[s.drawType||"rect"](o,s),o.restore(),o.isPointInPath(t.x,t.y)}function A(t){var e=g(t,!0);this.x=e.x,this.y=e.y,this.width=t.width,this.height=t.height}var w=Math.PI,E=w/180,x=Array.prototype.slice,S=document.createElement("canvas").getContext("2d");A.prototype={intersects:function(t){return t.x<=this.x+this.width&&t.x+t.width>=this.x&&t.y<=this.y+this.height&&t.y+t.height>=this.y}};var B={rect:function(t,e){t.rect(e.moveX,e.moveY,e.width,e.height)},arc:function(t,e){t.arc(e.radius+e.moveX,e.radius+e.moveY,e.radius,e.startAngle*w,e.endAngle*w,e.counterclockwise)},sector:function(t,e){t.moveTo(e.radius+e.moveX,e.radius+e.moveY),this.arc.apply(this,arguments)},arcTo:function(t,e){t.moveTo(e.moveX,e.moveY),t.arcTo(e.startX,e.startY,e.endX,e.endY,e.radius)},roundRect:function(t,e){t.roundRect(e.moveX,e.moveY,e.width,e.height,e.radius)},lineTo:function(t,e){t.moveTo(e.moveX,e.moveY),e.coords.forEach(function(e){t.lineTo.apply(t,e)})},line:function(t,e){t.moveTo(e.moveX,e.moveY),t.lineTo(e.endX,e.endY)},dashedLine:function(t,e){t.dashedLine(e.moveX,e.moveY,e.endX,e.endY,e.dashLength)},ellipse:function(t,e){t.ellipse(e.width/2+e.moveX,e.height/2+e.moveY,e.width,e.height)},clip:function(t){t.clip()},quadraticCurveTo:function(t,e){t.moveTo(e.moveX,e.moveY),t.quadraticCurveTo.apply(t,e.coords)},bezierCurveTo:function(t,e){t.moveTo(e.moveX,e.moveY),t.bezierCurveTo.apply(t,e.coords)}},C=t.Event.extend({initialize:function(){C.superclass.initialize.call(this),this.x=0,this.y=0,this.width=0,this.height=0,this.alpha=i,this.scaleX=1,this.scaleY=1,this.rotation=0,this.skewX=0,this.skewY=0,this.anchorX=0,this.anchorY=0,this.moveX=0,this.moveY=0,this.visible=!0,this.touchEnabled=!1,this._stageAdded=!1,this.cursor="pointer",this.$type="Sprite",this.children=[],Object.defineProperty(this,"numChildren",{get:function(){return this.size()},enumerable:!0}),this.once("addToStage",function(t){this.renderContext=t.renderContext,this.stage=t.stage,this._stageAdded=!0},this)},addChild:function(e,i){if(!t.isObject(e))throw new TypeError(String(e)+"is not a instance of EC");return e.parent=this,t.isNumber(i)?this.children.splice(i,0,e):this.children.push(e),this._stageAdded&&this._triggerAddToStage(e,this.stage),this},removeChild:function(t){return this.getChilds().splice(this.getChildIndex(t),1),this._stopTweens(t),this._triggerRemove(t),this},_triggerAddToStage:function(t,e){var i=function(t){return{target:t,renderContext:e.renderContext,stage:e}},o=function(t){t.dispatch("addToStage",i(t)),"Sprite"===t.$type&&t.each(o)};t.dispatch("addToStage",i(t)),t.each(o)},_triggerRemove:function(t){var e=function(t){t.dispatch("remove",t),"Sprite"===t.$type&&t.each(e)};t.dispatch("remove",t),t.each(e)},removeAllChildren:function(){return this._stopAllTweens(),this.children=[],this},getChilds:function(){return this.children},each:function(t){for(var e=this.getChilds(),i=0,o=e.length;i<o&&t.call(this,e[i],i,e)!==!1;i++);return this},broadcast:function(){function t(o){o.dispatch.apply(e,i),o.each(function(e){t(e)})}var e=this,i=x.call(arguments);return t(this),this},emit:function(){var t=this,e=x.call(arguments),i=this.parent;for(this.dispatch.apply(t,e);i;)i.dispatch.apply(t,e),i=i.parent;return this},getBounds:function(){return new A(this)},getChildIndex:function(t){return this.getChilds().indexOf(t)},size:function(){return this.children.length},setChildIndex:function(t,e){return this.removeChild(t),this.children.splice(e,0,t),this},setParams:function(e){if(t.isObject(e))for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);return this},transform:function(t,e,i,o,n,s){return this.x=n,this.y=s,this.scaleX=t,this.scaleY=o,this.skewX=e,this.skewY=i,this},setTransform:function(t,e,i,o,n,s){return this.x=n,this.y=s,this.rotation=t,this.scaleY=o,this.skewX=e,this.skewY=i,this},_stopTweens:function(e){t.Tween.removeTweens(e)},_stopAllTweens:function(){t.Tween.removeAllTweens(this)}}),P=C.extend({initialize:function(t,e,i,o,n,s,r,a,u){P.superclass.initialize.call(this),this.$text=t||"",this.$textArr=[],this.size=e||16,this.textAlign=s||"start",this.textBaseline="top",this.textColor=n||"#000",this.fontFamily=r||"Arial",this.strokeColor=n||"#000",this.textStyle="normal",this.textWeight="normal",this.lineSpacing=2,this.stroke=!1,this.strokeOnly=!1,this.multiple=!1,this.x=i||0,this.y=o||0,this.$width=a||0,this.$height=u||0,this.$type="TextField",this._isWidthDefined=!1,this._isHeightDefined=!1,Object.defineProperty(this,"text",{get:function(){return this.$text},set:function(t){this.$text=t,this.multiple?this.$textArr=h(this,t).split(/\n/):(this.$textArr=t.split(/\n/),this._isWidthDefined||(this.$width=l(this,c(this.$textArr)))),this._isHeightDefined||(this.$height=(this.size+this.lineSpacing)*this.numLines-this.lineSpacing)},enumerable:!0}),Object.defineProperty(this,"numLines",{get:function(){return this.$textArr.length},enumerable:!0}),Object.defineProperty(this,"width",{set:function(t){this.$width=t,this._isWidthDefined=!0},get:function(){return this.$width},enumerable:!0}),Object.defineProperty(this,"height",{set:function(t){this.$height=t,this._isHeightDefined=!0},get:function(){return this.$height},enumerable:!0}),this.$text&&(this.text=this.$text)}}),q=C.extend({initialize:function(e,i,o,n,s,r,a,h,c){q.superclass.initialize.call(this),this.x=i||0,this.y=o||0,t.isDefined(r)&&(this.sx=r),t.isDefined(a)&&(this.sy=a),t.isDefined(h)&&(this.swidth=h||.1),t.isDefined(c)&&(this.sheight=c||.1),this.$type="BitMap",t.isDefined(e)&&t.extend(this,t.isObject(e)?"IMG"===e.nodeName?{texture:e,width:e.width,height:e.height}:e:RES.getRes(e)),t.isDefined(n)&&(this.width=n),t.isDefined(s)&&(this.height=s)},setTexture:function(e){if(!t.isObject(e))throw new TypeError(String(e)+"is a invalid texture");return"nodeType"in e?this.texture=e:t.extend(this,e),this}}),F=C.extend({initialize:function(t,e,i,o){F.superclass.initialize.call(this),this.x=t||0,this.y=e||0,this.width=i||0,this.height=o||0,this.radius=0,this.dashLength=0,this.dashGap=0,this.shadowColor="#000",this.shadowBlur=0,this.shadowOffsetX=0,this.shadowOffsetY=0,this.coords=[],this._fill=!1,this._stroke=!1,this._closePath=!1,this.$type="Shape"},_setStyle:function(e,i,o){"number"==typeof o&&o<1?this[e]=t.Util.color.toRgb(i,o):this[e]=i||"#000"},fill:function(){var t=x.call(arguments);t.unshift("fillStyle"),this._fill=!0,this._setStyle.apply(this,t)},stroke:function(){var t=x.call(arguments);t.unshift("strokeStyle"),this._stroke=!0,this._setStyle.apply(this,t)},draw:function(t){B[this.drawType](t,this),this._closePath&&t.closePath(),this._fill&&t.fill(),this._stroke&&t.stroke()},close:function(){this._closePath=!0}});t.extend(F.prototype,{rect:function(t,e,i,o){return this.moveX=t,this.moveY=e,this.width=i,this.height=o,this.drawType="rect",this},arc:function(t,e,i,o,n,s){return this.moveX=t,this.moveY=e,this.radius=i,this.startAngle=o,this.endAngle=n,this.counterclockwise=s||!1,this.width=2*this.radius,this.height=2*this.radius,this.drawType="arc",this},sector:function(){return this.arc.apply(this,arguments),this.drawType="sector",this},arcTo:function(t,e,i,o,n){return this.startX=t,this.startY=e,this.endX=i,this.endY=o,this.radius=n,this.width=t-e,this.height=n,this.drawType="arcTo",this},roundRect:function(t,e,i,o,n){return this.moveX=t,this.moveY=e,this.width=i,this.height=o,this.radius=n,this.drawType="roundRect",this},moveTo:function(t,e){return this.moveX=t,this.moveY=e,this},lineTo:function(){this.coords=x.call(arguments);var t=m(this.coords);return this.width=t.width,this.height=t.height,this.drawType="lineTo",this},line:function(t,e,i,o){return this.moveX=t,this.moveY=e,this.endX=i,this.endY=o,this.width=i-t,this.height=this.lineWidth,this.drawType="line",this},dashedLine:function(t,e,i,o,n,s){return this.moveX=t,this.moveY=e,this.endX=i,this.endY=o,this.dashLength=n,this.dashGap=s||n,this.width=i-t,this.height=this.lineWidth,this.drawType="dashedLine",this},ellipse:function(t,e,i,o){return this.moveX=t,this.moveY=e,this.width=i,this.height=o,this.drawType="ellipse",this},clip:function(){return this.drawType="clip",this},quadraticCurveTo:function(){this.coords=x.call(arguments);var t=y([this.moveX,this.moveY].concat(this.coords));return this.width=t.width,this.height=t.height,this.drawType="quadraticCurveTo",this},bezierCurveTo:function(){this.coords=x.call(arguments);var t=y([this.moveX,this.moveY].concat(this.coords));return this.width=t.width,this.height=t.height,this.drawType="bezierCurveTo",this}}),t.extend(CanvasRenderingContext2D.prototype,{roundRect:function(t,e,i,o,n){return i<2*n&&(n=i/2),o<2*n&&(n=o/2),this.moveTo(t+n,e),this.arcTo(t+i,e,t+i,e+o,n),this.arcTo(t+i,e+o,t,e+o,n),this.arcTo(t,e+o,t,e,n),this.arcTo(t,e,t+i,e,n),this.closePath(),this},dashedLine:function(t,e,o,n,s){if(this.setLineDash)this.moveTo(t,e),this.lineTo(o,n);else for(var r=s===i?5:s,a=o-t,h=n-e,c=Math.floor(Math.sqrt(a*a+h*h)/r),l=0;l<c;l++)l%2===0?this.moveTo(t+a/c*l,e+h/c*l):this.lineTo(t+a/c*l,e+h/c*l);return this},ellipse:function(t,e,i,o){var n=i/.75/2,s=o/2;return this.moveTo(t,e-s),this.bezierCurveTo(t+n,e-s,t+n,e+s,t,e+s),this.bezierCurveTo(t-n,e+s,t-n,e-s,t,e-s),this.closePath(),this}});var T=F.extend({initialize:function(){T.superclass.initialize.apply(this,arguments),this.isMasker=!0},draw:function(t){T.superclass.draw.call(this,t),t.clip()}}),L=C.extend({initialize:function(t,e,i,o){L.superclass.initialize.call(this),this.x=t||0,this.y=e||0,this.width=i||0,this.height=o||0},addChild:function(t){this._addMask(),L.superclass.addChild.apply(this,arguments);var e=t.x+t.moveX,i=t.y+t.moveY,o=(t.lineWidth||0)/2,n=t.width+o,s=t.height+o;return 1===this.size()?(0===this.width?this.width=e+n:this._isWidthDefined=!0,0===this.height?this.height=i+s:this._isHeightDefined=!0):(!this._isWidthDefined&&e+n>this.width&&(this.width=e+n),!this._isHeightDefined&&i+s>this.height&&(this.height=i+s)),this},_addMask:function(){if(this.mask&&!this._isMaskAdded){if(!(this.mask instanceof t.Masker))throw new TypeError("mask must be a instance of EC.Masker");L.superclass.addChild.call(this,this.mask,0),this._isMaskAdded=!0}}}),M=L.extend({initialize:function(){M.superclass.initialize.apply(this,arguments),this.width=400,this.height=64,this.backgroundAlpha=1,this.backgroundColor="",this.backgroundImage="",this.backgroundRepeat="repeat",this.borderAlpha=1,this.borderColor="#000",this.borderRadius=0,this.borderWidth=2,this.padding=3,this.fontSize=28,this.color="#000",this.placeholderColor="#999",this.placeholder="",this.fontFamily="",this.lineHeight=16,this.lineSpacing=2,this.inputType="text",this.on("addToStage",function(){this._create(),this._events()},this),this.on("remove",function(){this.inputText.parentNode.removeChild(this.inputText),window.removeEventListener(t.EVENTS.RESIZE,this.resizeListener,!1)},this)},_create:function(){var e=this.padding;this.touchEnabled=!0,this.cursor="",this.padding=t.isArray(e)?e:[e,e,e,e],this.input=new F,this.textField=new P,this.inputText=document.createElement("textarea"===this.inputType?"textarea":"input"),this.input.x=this.borderWidth/2,this.input.y=this.borderWidth/2,this.input.lineWidth=this.borderWidth,this.input.stroke(this.borderColor,this.borderAlpha);var i=this.backgroundImage;if(t.isObject(i)){var o=this.renderContext.createPattern("IMG"===i.nodeName?i:i.texture,this.backgroundRepeat);this.input.fill(o)}else this.backgroundColor&&this.input.fill(this.backgroundColor,this.backgroundAlpha);this.borderRadius>0?this.input.roundRect(0,0,this.width,this.height,this.borderRadius):this.input.rect(0,0,this.width,this.height),"textarea"!==this.inputType&&(this.inputText.type=this.inputType),this.placeholder&&(this.inputText.setAttribute("placeholder",this.placeholder),this.textField.text=this.placeholder,this.textField.textColor=this.placeholderColor),this.textField.width=this.width-this.padding[1]-this.padding[3],this.textField.multiple=!0,this.textField.lineSpacing="textarea"!==this.inputType?this.height:this.lineSpacing,this.textField.size=this.fontSize,this.textField.fontFamily=this.fontFamily||this.textField.fontFamily,this.textField.x=this.borderWidth+this.padding[3],this.textField.y="textarea"===this.inputType?this.padding[0]:(this.height-this.textField.height+this.borderWidth)/2,this.mask=new T,this.mask.rect(0,0,this.width+this.borderWidth,this.height+this.borderWidth),this.addChild(this.input),this.addChild(this.textField),this._setInputStyle(),document.body.appendChild(this.inputText)},_setInputStyle:function(){var t=this,e=1/this.stage.scaleRatio,i="textarea"!==this.inputType?this.height:this.lineHeight,o=g(this);this.inputText.style.cssText="display:none;position:absolute;border:none;background:none;outline:none;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-text-size-adjust:none;text-size-adjust:none;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:auto;resize:none;left:"+(o.x+t.borderWidth/2)*e+"px;top:"+o.y*e+"px;width:"+this.width*e+"px;height:"+this.height*e+"px;line-height:"+i*e+"px;font-size:"+this.fontSize*e+"px;font-family:"+(this.fontFamily||this.textField.fontFamily)+";color:"+this.color+";padding:"+this.padding.map(function(i){return(i+t.borderWidth/2)*e+"px"}).join(" ")},_events:function(){this.on("touch",function(){this.textField.visible=!1,this.inputText.style.display="block",this.inputText.focus()},this),this.inputText.addEventListener("focus",function(t){this.dispatch("focus",{target:this,originalEvent:t,value:this.inputText.value})}.bind(this),!1),this.inputText.addEventListener("change",function(t){this.dispatch("change",{target:this,originalEvent:t,value:this.inputText.value})}.bind(this),!1),this.inputText.addEventListener("blur",function(t){var e=this.inputText.value;this.textField.text=e||this.placeholder,this.textField.textColor=e?this.color:this.placeholderColor,this.textField.visible=!0,this.inputText.style.display="none",this.dispatch("blur",{target:this,originalEvent:t,value:e})}.bind(this),!1),this.inputText.addEventListener("input",function(t){this.dispatch("input",{target:this,originalEvent:t,value:this.inputText.value})}.bind(this),!1),window.addEventListener(t.EVENTS.RESIZE,this.resizeListener=function(){this._setInputStyle()}.bind(this),!1)}}),_=L.extend({initialize:function(){_.superclass.initialize.apply(this,arguments),this.$text="",this.font="",this.textAlign="left",this.letterSpacing=0,this.$type="BitMapText",this.$textArr=[],Object.defineProperty(this,"text",{set:function(t){this.$text=t,this.$textArr=t.split("")},get:function(){return this.$text},enumerable:!0}),this.on("addToStage",function(){this._create()},this)},_create:function(){this.fontData=(t.isString(this.font)?RES.getRes(this.font+"_fnt"):this.font).data,this.fontTexture=RES.getRes(this.fontData.file.replace(/\.(\w+)$/,"_$1")).texture}}),R=L.extend({initialize:function(e){R.superclass.initialize.call(this);var i={x:0,y:0,size:16,textColor:"#000",alpha:1},o=t.extend({},i,this._getConfig(e.normal)||{}),n=t.extend({},i,this._getConfig(e.hover)||{}),s=t.extend({},i,this._getConfig(e.active)||{}),r=t.extend({},i,this._getConfig(e.disabled)||{});this.statusCfg={normal:o,hover:n,active:s,disabled:r};for(var a in this.statusCfg)t.isString(this.statusCfg[a].texture)&&t.extend(this.statusCfg[a],RES.getRes(this.statusCfg[a].texture));this.bitMap=new q,this.shape=new F,this.textField=new P,this.on("addToStage",function(){this._create(),this._events()},this)},_create:function(){this.setButton("normal"),this.addChild(this.bitMap),this.addChild(this.shape),this.addChild(this.textField)},_getConfig:function(e){return t.isString(e)?RES.getRes(e):e},setButton:function(e){this.touchEnabled="disabled"!==e;var i=t.isString(e)?this.statusCfg[e]:e;if(i=t.extend({},this.statusCfg.normal,i),t.extend(this,{width:i.width,height:i.height}),i.texture?(t.extend(this.bitMap,{x:i.x,y:i.y,alpha:i.alpha,texture:i.texture,width:i.width,height:i.height}),this.bitMap.visible=!0):this.bitMap.visible=!1,i.fillStyle||i.strokeStyle?(t.extend(this.shape,i),i.radius&&i.radius>0?this.shape.roundRect(0,0,i.width,i.height,i.radius):this.shape.rect(0,0,i.width,i.height),i.fillStyle&&this.shape.fill(i.fillStyle),i.strokeStyle&&this.shape.stroke(i.strokeStyle),this.shape.visible=!0):this.shape.visible=!1,i.text){this.textField.text=i.text;var o={textAlign:"center",y:i.y+(this.height-this.textField.height)/2,height:this.textField.height};t.extend(this.textField,t.extend({},i,o)),this.textField.visible=!0}else this.textField.visible=!1;return i},_events:function(){this.on("touchstart",function(){this.setButton("active")},this),this.on("touchend",function(){this.setButton("normal")},this),t.isTouch||(this.on("touchenter",function(){this.setButton("hover")},this),this.on("touchout",function(){this.setButton("normal")},this))}}),I=t.Event.extend({initialize:function(t,e){I.superclass.initialize.call(this),this.x=t||0,this.y=e||0},toString:function(){return"[object EC.Point("+this.x+","+this.y+")]"},set:function(t,e){this.x=t,this.y=e},clone:function(){return new I(this.x,this.y)},add:function(t){return new I(this.x+t.x,this.y+t.y)},distance:function(){return I.calcDistance(this.x,this.y,0,0)},copyFrom:function(t){this.set(t.x,t.y)},equals:function(t){return this.x===t.x&&this.y===t.y},normalize:function(t){var i=this,o=i/e.distance();i.x*=o,i.y*=o},offset:function(t,e){this.x+=t,this.y+=e},subtract:function(t){return new I(this.x-t.x,this.y-t.y)},getAngle:function(){return I.getAngle(0,0,this.x,this.y)}});t.extend(I,{
calcDistance:function(t,e,i,o){var n=Math.abs(i-t),s=Math.abs(o-e);return Math.sqrt(n*n+s*s)},distance:function(t,e){return this.calcDistance(t.x,t.y,e.x,e.y)},getAngle:function(t,e,i,o){var n=Math.abs(t-i),s=Math.abs(e-o),r=Math.sqrt(Math.pow(n,2)+Math.pow(s,2)),a=s/r,h=Math.acos(a),c=180/(Math.PI/h);return i>t&&o>e&&(c=180-c),i===t&&o>e&&(c=180),i>t&&o===e&&(c=90),i<t&&o>e&&(c=180+c),i<t&&o===e&&(c=270),i<t&&o<e&&(c=360-c),c}});var O=C.extend({initialize:function(e,i){O.superclass.initialize.call(this),this.canvas=e,this.renderContext=this.canvas.getContext("2d"),this.compositeOperation="source-over",this.options=t.extend({},{showFps:!1,scaleMode:"showAll",width:window.innerWidth,height:window.innerHeight},i||{}),this.width=parseFloat(this.canvas.getAttribute("width"))||this.options.width,this.height=parseFloat(this.canvas.getAttribute("height"))||this.options.height,this.scaleRatio=1,this.cursor="",this._isRendering=!1,this._ticker=new t.Ticker,this.canvas.width=this.width,this.canvas.height=this.height,"noScale"!==this.options.scaleMode&&this.setAdapter(),this.options.showFps&&(this.createFps(),this.showFps()),this._initEvents(),this.start()},addChild:function(t){return O.superclass.addChild.apply(this,arguments),this._triggerAddToStage(t,this),this},render:function(){var t=this,e=this.renderContext,i=function(o){o.visible&&("Sprite"===o.$type?(e.save(),p(e,o),o.each(function(t){i(t)}),e.restore()):t._renderItem(o,e))};return e.globalCompositeOperation=this.compositeOperation,i(this),this},_renderItem:function(t,e){switch(t.isMasker||e.save(),p(e,t),t.$type){case"BitMap":o(e,t);break;case"BitMapText":s(e,t);break;case"TextField":r(e,t);break;case"Shape":u(e,t)}t.isMasker||e.restore()},clear:function(){return this.renderContext.clearRect(0,0,this.width,this.height),this},start:function(){if(!this._isRendering)return this._isRendering=!0,this._ticker.start(),this},stop:function(){return this._ticker.stop(),this.dispatch("stop"),this._isRendering=!1,this},_triggerEnterFrame:function(){var t=function(e){e.dispatch("enterframe",e),"Sprite"===e.$type&&e.each(t)};t(this)},setAdapter:function(){var e=this.canvas.parentNode,i="BODY"===e.nodeName?window.innerWidth:e.offsetWidth-parseFloat(t.getStyle(e,"padding-left"))-parseFloat(t.getStyle(e,"padding-right")),o="BODY"===e.nodeName?window.innerHeight:e.offsetHeight-parseFloat(t.getStyle(e,"padding-top"))-parseFloat(t.getStyle(e,"padding-bottom")),n=i,s=this.height/this.width*n;switch(this.options.scaleMode){case"showAll":s>o&&(s=o,n=this.width/this.height*s);break;case"fixedWidth":}return this.canvas.style.width=n+"px",this.canvas.style.height=s+"px",this.scaleRatio=this.width/n,this},_initEvents:function(){var e=this.options.showFps;this._ticker.on("ticker",function(){e&&this.FPS.begin(),this.clear(),this.render(),this._triggerEnterFrame(),e&&this.FPS.end()},this),"noScale"!==this.options.scaleMode&&window.addEventListener(t.EVENTS.RESIZE,function(){this.setAdapter()}.bind(this),!1),(new t.TouchEvent).attach(this)},createFps:function(){this.FPS=new Stats},showFps:function(e){t.isObject(e)&&(this.FPS.dom.style.left=t.isDefined(e.left)?t.isNumber(e.left)?e.left+"px":e.left:"",this.FPS.dom.style.right=t.isDefined(e.right)?t.isNumber(e.right)?e.right+"px":e.right:"",this.FPS.dom.style.top=t.isDefined(e.top)?t.isNumber(e.top)?e.top+"px":e.top:"",this.FPS.dom.style.bottom=t.isDefined(e.bottom)?t.isNumber(e.bottom)?e.bottom+"px":e.bottom:""),this._fpsDom||document.body.appendChild(this._fpsDom=this.FPS.dom)}});["createLinearGradient","createPattern","createRadialGradient","addColorStop","createImageData","putImageData","getImageData","isPointInPath"].forEach(function(t){O.prototype[t]=function(){return this.renderContext[t].apply(this,arguments)}}),t.provide({TextField:P,BitMap:q,BitMapText:_,Shape:F,TextInput:M,Masker:T,DisplayObjectContainer:C,Sprite:L,Button:R,Point:I,Stage:O,isPointInPath:b})}(window.EC),function(t,e){"use strict";var i=t.Sprite.extend({initialize:function(e,o,n){if(i.superclass.initialize.call(this),this._startFrame=0,this._startTime=0,this._playTimes=-1,this._resKey=n,this.currentFrame=0,this.isPlaying=!1,this.setRES(e,o),this._clip=new t.BitMap(this.RESUrl),Array.isArray(this.RESUrl))this.width=this.RESUrl[0].width,this.height=this.RESUrl[0].height,this.totalFrames=this.RESUrl.length,this.setFrame=this.setFrameByPath;else{var s=this.RES.mc[n].frames[0].res,r=this.RES.res[s];this.width=r.w,this.height=r.h,this.setFrame=this.setFrameBySprite}this._timer=new t.Timer(this.frameRate,this._repeatCount),this._initEvents()},setRES:function(e,i,s){this.RESUrl=o(e),this.RES=n(i,this._resKey),this.currentFrame=0,this.frame=this.getMovieClipData(this._resKey),this.frameRate=Math.round(1e3/(this.frame.frameRate||24)),this.totalFrames=this.frame.frames.length,Array.isArray(this.RESUrl)?this.texture=this.RESUrl[this.currentFrame].texture:(t.isObject(this.RESUrl)&&"nodeType"in this.RESUrl&&(this.RESUrl={texture:this.RESUrl,width:this.RESUrl.width,height:this.RESUrl.height}),this.texture=this.RESUrl.texture),s&&this.setFrameRate(s)},getMovieClipData:function(t){return this.RES.mc[t]||[]},gotoAndPlay:function(t,e,i){return t=Math.max(0,t-1),this._startFrame=t,this._playTimes=e,this.currentFrame=t,this._playTimes>0&&(this._repeatCount=this._playTimes*this.totalFrames,this._timer.setRepeatCount(this._repeatCount)),i&&this.setFrameRate(Math.round(1e3/i)),this.setFrame(this.currentFrame),this.play(),this},gotoAndStop:function(t){return this.stop(),this.setFrame(t),this},prevFrame:function(){return this.setFrame(--this.currentFrame)},nextFrame:function(){return this.setFrame(++this.currentFrame)},play:function(){return this.isPlaying?this:(this._startTime=Date.now(),this._timer.start(),this.isPlaying=!0,this)},stop:function(){return this._timer.stop(),this.isPlaying=!1,this},pause:function(t){return this._timer.pause(t),this._startTime+=t,this.isPlaying=!1,this},wait:function(t){return this._timer.wait(t),this},setFrameRate:function(t){this.frameRate=t},setFrameBySprite:function(t){var i=this.frame.frames[t]||{},o=this.RES.res[i.res];if(o!==e)return this._timer.delay=(i.duration||0)*this.frameRate,this._clip.x=i.x||0,this._clip.y=i.y||0,this._clip.sx=o.x||0,this._clip.sy=o.y||0,this._clip.swidth=o.w||this.width||0,this._clip.sheight=o.h||this.height||0,this._clip.width=this._clip.swidth,this._clip.height=this._clip.sheight,this.width=this._clip.width,this.height=this._clip.height,this},setFrameByPath:function(t){var e=this.frame.frames[t]||{},i=this.RESUrl[t];return this._timer.delay=(e.duration||0)*this.frameRate,this._clip.texture=i.texture,this._clip.x=e.x||0,this._clip.y=e.y||0,this._clip.width=i.width||this._clip.width||0,this._clip.height=i.height||this._clip.height||0,this.width=this._clip.width,this.height=this._clip.height,this},_initEvents:function(){this.on("addToStage",function(){this.addChild(this._clip)},this),this._timer.on("timer",function(){++this.currentFrame>this.totalFrames-1&&(this.currentFrame=this._startFrame,this.dispatch("loopcomplete")),this.setFrame(this.currentFrame)},this),this._timer.on("complete",function(){this.off("enterframe"),this.dispatch("complete")},this),this._timer.on("pause",function(){this.dispatch("pause")},this)}}),o=function(t){return/_(png|jpg|jpeg|gif|bmp|webp)$/.test(t)?RES.getRes(t):t},n=function(t,i){if("string"==typeof t)return RES.getRes(t);if(Array.isArray(t)){var o=[],n={},r={mc:{},res:{}};return t.forEach(function(t){var e=t.split(" "),i=s();o.push({res:i,x:0,y:0,duration:1}),n[i]={x:-1*e[0],y:-1*e[1]}}),r.mc[i]={frames:o,frameRate:24},r.res=n,r}if("object"==typeof t&&!t.mc){var o=[],n={},r={mc:{},res:{}};for(var a in t){var h=t[a],c=s();o.push({res:c,key:a,x:h.offX,y:h.offY,duration:h.duration===e?1:h.duration}),n[c]={x:h.x,y:h.y,w:h.w,h:h.h}}return o=o.sort(function(t,e){return parseInt(t.key.replace(/^[^\d]+/,""))-parseInt(e.key.replace(/^[^\d]+/,""))}),r.mc[i]={frames:o,frameRate:24},r.res=n,r}return t},s=function(t){var e="",i=0;for(t=t||8;i++<t;)e+=Math.floor(16*Math.random()).toString(16);return e.toUpperCase()};t.provide({MovieClip:i})}(window.EC),function(t,e){"use strict";function i(t){try{return t.getBoundingClientRect()}catch(t){return{left:0,top:0}}}function o(t,o){if(h&&o.layerX!==e&&o.layerX!==o.offsetX)return{x:o.layerX,y:o.layerY};if(o.offsetX!==e)return{x:o.offsetX,y:o.offsetY};var n=i(t);return{x:o.clientX-n.left,y:o.clientY-n.top}}function n(){return!0}function s(){return!1}var r=t.EVENTS,a=t.isTouch,h=/Firefox\/([\d.]+)/.test(navigator.userAgent),c=function(){this.enableStack=[],this._touchX=0,this._touchY=0,this._lastObject=null,this._touchTimer=null};c.prototype={attach:function(t){this.stage=t,this.element=t.canvas,this._startTime=0,this._bindEvents()},_bindEvents:function(){this.element.addEventListener(r.START,this._onTouchStart.bind(this),!1),this.element.addEventListener(r.MOVE,this._onTouchMove.bind(this),!1),this.element.addEventListener(r.END,this._onTouchEnd.bind(this),!1),this.element.addEventListener("mouseout",this._onMouseOut.bind(this),!1)},_onTouchStart:function(t){t=a?t.targetTouches[0]:t,this._startTime=Date.now(),this._clearTouchTimer(),this._setTouchXY(t),this.enableStack=this._getTouchEnables(),this._triggerEvent("touchstart",t),this._touchTimer=setTimeout(function(){this._triggerEvent("longtouch",t)}.bind(this),600)},_onTouchMove:function(e){e.preventDefault(),e=a?e.changedTouches[0]:e,this._clearTouchTimer(),t.isTouch||(this.enableStack=this._getTouchEnables()),this._setTouchXY(e),this._triggerEvent("touchmove",e)},_onTouchEnd:function(t){t=a?t.changedTouches[0]:t,this._clearTouchTimer(),this._setTouchXY(t),this._triggerEvent("touchend",t);var e=Date.now()-this._startTime;e<200&&this._triggerEvent("touch",t),this._resetTouch()},_onMouseOut:function(){this._clearTouchTimer(),this._resetTouch(),this._triggerLastStack()},_clearTouchTimer:function(){this._touchTimer&&clearTimeout(this._touchTimer)},_resetTouch:function(){this._lastObject=null},_triggerEvent:function(e,i){var o=this,n=this.stage.scaleRatio,s=!t.isTouch&&"touchmove"===e,r=this.enableStack.find(function(e){return t.isPointInPath({x:o._touchX*n,y:o._touchY*n},e)});if(s&&this._lastObject!==r&&this._triggerLastStack(),r){var a=t.extend({type:e,stageX:this._touchX*n,stageY:this._touchY*n},this._getOriginalEventProps(i));i=new l(i,a);for(var h=r;h&&!i.isPropagationStopped();)"Sprite"===h.$type||"Stage"===h.$type?h.touchEnabled&&h.dispatch(e,t.extend(i,{target:this._getTouchedTarget(h)||h})):h.dispatch(e,t.extend(i,{target:h})),s&&h.touchEnabled&&!h._touchentered&&this._lastObject!==h&&(h.dispatch("touchenter",t.extend(i,{type:"touchenter",target:h})),h.cursor&&(this.element.style.cursor=h.cursor),h._touchentered=!0),h=h.parent}this._lastObject=r},_triggerLastStack:function(){var t=this._lastObject;for(t&&(t.dispatch("touchout",{type:"touchout",target:t}),this.element.style.cursor="",this._lastObject=null);t;)delete t._touchentered,t=t.parent},_getTouchedTarget:function(e){function i(t){for(var e=t.getChilds(),n=e.length;n--;)e[n].visible&&("Sprite"===e[n].$type?i(e[n]):o.push(e[n]))}var o=[],n=this,s=this.stage.scaleRatio;return i(e),o.find(function(e){return t.isPointInPath({x:n._touchX*s,y:n._touchY*s},e)})},_getTouchEnables:function(){function t(i){for(var o=i.getChilds(),n=o.length;n--;)o[n].visible&&("Sprite"===o[n].$type&&t(o[n]),o[n].touchEnabled&&e.push(o[n]))}var e=[];return t(this.stage),this.stage.touchEnabled&&e.push(this.stage),e},_getOriginalEventProps:function(t){var e={};return["pageX","pageY","clientX","clientY","screenX","screenY","radiusX","radiusY","rotationAngle"].forEach(function(i){e[i]=t[i]}),e},_setTouchXY:function(t){var e=o(this.element,t);this._touchX=e.x,this._touchY=e.y}};var l=function(i,o){i&&i.type?(this.originalEvent=i,this.type=i.type,this.isDefaultPrevented=i.defaultPrevented||i.defaultPrevented===e&&i.returnValue===!1?n:s,this.target=i.target,this.currentTarget=i.currentTarget,this.relatedTarget=i.relatedTarget):this.type=i,o&&t.extend(this,o),this.timeStamp=i&&i.timeStamp||Date.now()};l.prototype={constructor:l,isDefaultPrevented:s,isPropagationStopped:s,isImmediatePropagationStopped:s,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=n,t&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=n,t&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=n,t&&t.stopImmediatePropagation(),this.stopPropagation()}},t.provide({TouchEvent:c})}(window.EC);var Stats=function(){function t(){return window.performance&&performance.now?performance.now():Date.now()}function e(t){return n.appendChild(t.dom),t}function i(t){for(var e=0;e<n.children.length;e++)n.children[e].style.display=e===t?"block":"none";o=t}var o=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(t){t.preventDefault(),i(++o%n.children.length)},!1);var s=t(),r=s,a=0,h=e(new Stats.Panel("FPS","#0ff","#002")),c=e(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new Stats.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:e,showPanel:i,begin:function(){s=t()},end:function(){a++;var e=t();if(c.update(e-s,200),e>r+1e3&&(h.update(1e3*a/(e-r),100),r=e,a=0,l)){var i=performance.memory;l.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:n,setMode:i}};Stats.Panel=function(t,e,i){var o=1/0,n=0,s=Math.round,r=s(window.devicePixelRatio||1),a=80*r,h=48*r,c=3*r,l=2*r,u=3*r,p=15*r,d=74*r,f=30*r,v=document.createElement("canvas");v.width=a,v.height=h,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*r+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,a,h),m.fillStyle=e,m.fillText(t,c,l),m.fillRect(u,p,d,f),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(u,p,d,f),{dom:v,update:function(h,y){o=Math.min(o,h),n=Math.max(n,h),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,a,p),m.fillStyle=e,m.fillText(s(h)+" "+t+" ("+s(o)+"-"+s(n)+")",c,l),m.drawImage(v,u+r,p,d-r,f,u,p,d-r,f),m.fillRect(u+d-r,p,r,f),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(u+d-r,p,r,s((1-h/y)*f))}}},"object"==typeof module&&(module.exports=Stats);